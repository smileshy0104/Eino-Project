# äº§å“æ–‡æ¡£AIåŠ©æ‰‹è®¾è®¡æ–¹æ¡ˆ

åŸºäº Eino æ¡†æ¶çš„æ™ºèƒ½æ–‡æ¡£æ£€ç´¢ç³»ç»Ÿ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ é¡¹ç›®èƒŒæ™¯
åœ¨æ•æ·å¼€å‘æ¨¡å¼ä¸‹ï¼Œäº§å“éœ€æ±‚æ–‡æ¡£æ›´æ–°é¢‘ç¹ï¼Œå†å²ç‰ˆæœ¬ä¼—å¤šï¼Œå›¢é˜Ÿæˆå‘˜åœ¨æŸ¥æ‰¾ç‰¹å®šéœ€æ±‚ä¿¡æ¯æ—¶é¢ä¸´ä»¥ä¸‹ç—›ç‚¹ï¼š
- ğŸ“ æ–‡æ¡£åˆ†æ•£åœ¨ä¸åŒç‰ˆæœ¬å’Œæ–‡ä»¶å¤¹ä¸­
- ğŸ” å…³é”®è¯æœç´¢æ•ˆæœä¸ä½³ï¼Œæ— æ³•ç†è§£è¯­ä¹‰
- â° æŸ¥æ‰¾å†å²éœ€æ±‚è€—æ—¶è¿‡é•¿ï¼Œå½±å“å¼€å‘æ•ˆç‡
- ğŸ”„ æ–‡æ¡£æ›´æ–°åå›¢é˜ŸåŒæ­¥å›°éš¾

### ğŸ’¡ è§£å†³æ–¹æ¡ˆ
æ„å»ºä¸€ä¸ªåŸºäº Eino æ¡†æ¶çš„æ™ºèƒ½æ–‡æ¡£åŠ©æ‰‹ï¼Œå…·å¤‡ï¼š
- ğŸ¤– **æ™ºèƒ½é—®ç­”**ï¼šè‡ªç„¶è¯­è¨€æŸ¥è¯¢å†å²éœ€æ±‚
- ğŸ“š **è¯­ä¹‰æ£€ç´¢**ï¼šç†è§£éœ€æ±‚æ„å›¾ï¼Œç²¾å‡†åŒ¹é…æ–‡æ¡£
- ğŸ”„ **å®æ—¶åŒæ­¥**ï¼šè‡ªåŠ¨æ›´æ–°å‘é‡åº“ï¼Œä¿æŒæ•°æ®æœ€æ–°
- ğŸ“¢ **å›¢é˜Ÿé€šçŸ¥**ï¼šé€šè¿‡é£ä¹¦æœºå™¨äººæ¨é€æ–‡æ¡£å˜æ›´

---

## ğŸ†š å·®å¼‚åŒ–ä¼˜åŠ¿åˆ†æ

### ä¸é£ä¹¦åŸç”Ÿ"çŸ¥è¯†é—®ç­”"ç»„ä»¶çš„æ ¸å¿ƒåŒºåˆ«

#### ğŸ¢ **é£ä¹¦çŸ¥è¯†é—®ç­”çš„ç‰¹ç‚¹**
- **å°é—­ç”Ÿæ€**: å®Œå…¨ä¾èµ–é£ä¹¦çš„AIèƒ½åŠ›å’Œæ•°æ®å¤„ç†
- **æ ‡å‡†åŒ–åŠŸèƒ½**: æä¾›å›ºå®šçš„é—®ç­”æ¨¡å¼ï¼Œå®šåˆ¶åŒ–ç©ºé—´æœ‰é™
- **æ•°æ®è¾¹ç•Œ**: ä¸»è¦åŸºäºé£ä¹¦å†…çš„ç»“æ„åŒ–çŸ¥è¯†åº“
- **äº¤äº’æ¨¡å¼**: ç›¸å¯¹ç®€å•çš„é—®ç­”å½¢å¼

#### ğŸš€ **æˆ‘ä»¬Eino AIåŠ©æ‰‹çš„æ ¸å¿ƒä¼˜åŠ¿**

##### 1. **æŠ€æœ¯æ¶æ„çµæ´»æ€§** ğŸ”§
```
é£ä¹¦çŸ¥è¯†é—®ç­”: é»‘ç›’AI â†’ æ ‡å‡†å›ç­”
æˆ‘ä»¬çš„æ–¹æ¡ˆ:   Einoç¼–æ’ â†’ å¤šæ¨¡å‹åä½œ â†’ å®šåˆ¶åŒ–å¤„ç†
```

##### 2. **æ•°æ®å¤„ç†èƒ½åŠ›** ğŸ“Š
- **é£ä¹¦**: ä¾èµ–é£ä¹¦çš„æ–‡æ¡£è§£æèƒ½åŠ›
- **æˆ‘ä»¬**: 
  - è‡ªå®šä¹‰Transformerè¿›è¡Œæ™ºèƒ½åˆ†å—
  - ä¸“ä¸šçš„å‘é‡åŒ–å¤„ç†(Milvus)
  - æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼çš„æ·±åº¦è§£æ

##### 3. **æ¨¡å‹é€‰æ‹©è‡ªä¸»æƒ** ğŸ¤–
- **é£ä¹¦**: ä½¿ç”¨é£ä¹¦å†…ç½®æ¨¡å‹ï¼Œæ— æ³•æ›´æ¢
- **æˆ‘ä»¬**: 
  - å¯é€‰æ‹©ç«å±±æ–¹èˆŸçš„ä¸åŒæ¨¡å‹
  - æ”¯æŒæ¨¡å‹çƒ­åˆ‡æ¢å’ŒA/Bæµ‹è¯•
  - å¯æ¥å…¥å…¶ä»–LLMæœåŠ¡å•†

##### 4. **ä¸šåŠ¡é€»è¾‘å®šåˆ¶** âš™ï¸
```go
// æˆ‘ä»¬å¯ä»¥å®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
chain := compose.NewChain().
    AddLambda(customDocumentFilter).     // è‡ªå®šä¹‰æ–‡æ¡£è¿‡æ»¤
    AddLambda(businessContextEnhancer).  // ä¸šåŠ¡ä¸Šä¸‹æ–‡å¢å¼º
    AddRetriever(smartRetriever).        // æ™ºèƒ½æ£€ç´¢
    AddLambda(answerPostProcessor).      // å›ç­”åå¤„ç†
    AddChatModel(chatModel)
```

##### 5. **å·¥å…·æ‰©å±•èƒ½åŠ›** ğŸ› ï¸
- **é£ä¹¦**: åŠŸèƒ½ç›¸å¯¹å›ºå®š
- **æˆ‘ä»¬**: å¯é›†æˆå„ç§Tools
  - è®¡ç®—å™¨ã€å¤©æ°”æŸ¥è¯¢
  - å¤–éƒ¨APIè°ƒç”¨
  - å®æ—¶æ•°æ®è·å–
  - å·¥ä½œæµè§¦å‘

##### 6. **æ•°æ®å®‰å…¨ä¸éšç§** ğŸ”’
- **é£ä¹¦**: æ•°æ®åœ¨é£ä¹¦äº‘ç«¯å¤„ç†
- **æˆ‘ä»¬**: 
  - æœ¬åœ°éƒ¨ç½²é€‰é¡¹
  - æ•°æ®å¤„ç†è·¯å¾„å¯æ§
  - ç¬¦åˆä¼ä¸šå®‰å…¨åˆè§„è¦æ±‚

##### 7. **æˆæœ¬æ§åˆ¶** ğŸ’°
- **é£ä¹¦**: æŒ‰é£ä¹¦å®šä»·ï¼Œæˆæœ¬ä¸é€æ˜
- **æˆ‘ä»¬**: 
  - ç›´æ¥å¯¹æ¥æ¨¡å‹æœåŠ¡å•†
  - æˆæœ¬é€æ˜å¯æ§
  - å¯æ ¹æ®ä½¿ç”¨é‡ä¼˜åŒ–

##### 8. **é›†æˆæ‰©å±•æ€§** ğŸ”—
```go
// å¯ä»¥è½»æ¾é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
type EnterpriseAIAssistant struct {
    einoChain    *compose.Chain
    crm          *CRMSystem
    workFlow     *WorkFlowEngine  
    notification *NotificationService
}
```

#### ğŸ¯ **å…·ä½“åº”ç”¨åœºæ™¯å·®å¼‚**

##### **é£ä¹¦çŸ¥è¯†é—®ç­”é€‚åˆ**:
- ç®€å•çš„FAQæŸ¥è¯¢
- æ ‡å‡†åŒ–çš„çŸ¥è¯†ç®¡ç†
- å¿«é€Ÿéƒ¨ç½²éœ€æ±‚

##### **æˆ‘ä»¬çš„Einoæ–¹æ¡ˆé€‚åˆ**:
- å¤æ‚ä¸šåŠ¡é€»è¾‘å¤„ç†
- å¤šæ•°æ®æºæ•´åˆåˆ†æ
- å®šåˆ¶åŒ–AIäº¤äº’ä½“éªŒ
- ä¼ä¸šçº§å®‰å…¨åˆè§„è¦æ±‚

#### ğŸš€ **ç‹¬ç‰¹ä»·å€¼ä¸»å¼ **

1. **æ™ºèƒ½ç¼–æ’èƒ½åŠ›**: é€šè¿‡Chainå®ç°å¤æ‚çš„æ•°æ®å¤„ç†æµç¨‹
2. **å¤šæ¨¡æ€æ”¯æŒ**: å¯å¤„ç†æ–‡æ¡£ã€å›¾åƒã€è¯­éŸ³ç­‰å¤šç§å†…å®¹
3. **å®æ—¶å­¦ä¹ **: é€šè¿‡Lambdaå®ç°åœ¨çº¿å­¦ä¹ å’Œæ¨¡å‹å¾®è°ƒ
4. **ä¼ä¸šçº§éƒ¨ç½²**: æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²å’Œæ··åˆäº‘æ¶æ„

#### ğŸ“Š **ç«äº‰ä¼˜åŠ¿æ€»ç»“**

| ç»´åº¦ | é£ä¹¦çŸ¥è¯†é—®ç­” | æˆ‘ä»¬çš„Einoæ–¹æ¡ˆ |
|------|-------------|---------------|
| ğŸ—ï¸ **æ¶æ„çµæ´»æ€§** | é»‘ç›’ï¼Œæ— æ³•å®šåˆ¶ | å®Œå…¨å¯ç¼–ç¨‹ï¼Œçµæ´»ç¼–æ’ |
| ğŸ¤– **æ¨¡å‹é€‰æ‹©** | å›ºå®šå†…ç½®æ¨¡å‹ | å¤šæ¨¡å‹æ”¯æŒï¼Œå¯çƒ­åˆ‡æ¢ |
| ğŸ”§ **åŠŸèƒ½æ‰©å±•** | æ ‡å‡†åŒ–åŠŸèƒ½ | æ— é™æ‰©å±•ï¼Œå·¥å…·ä¸°å¯Œ |
| ğŸ”’ **æ•°æ®å®‰å…¨** | äº‘ç«¯å¤„ç† | æœ¬åœ°éƒ¨ç½²ï¼Œå®Œå…¨å¯æ§ |
| ğŸ’° **æˆæœ¬æ§åˆ¶** | ä¸é€æ˜å®šä»· | é€æ˜æˆæœ¬ï¼Œç²¾ç¡®æ§åˆ¶ |
| ğŸ”— **ç³»ç»Ÿé›†æˆ** | é£ä¹¦ç”Ÿæ€å†… | ä¼ä¸šçº§å…¨æ ˆé›†æˆ |

**ç»“è®º**: æˆ‘ä»¬çš„Einoæ–¹æ¡ˆä¸æ˜¯è¦æ›¿ä»£é£ä¹¦çŸ¥è¯†é—®ç­”ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ª**æ›´åŠ çµæ´»ã€å¯æ§ã€å¯æ‰©å±•çš„ä¼ä¸šçº§AIåŠ©æ‰‹è§£å†³æ–¹æ¡ˆ**ï¼Œç‰¹åˆ«é€‚åˆæœ‰ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ã€å®‰å…¨åˆè§„è¦æ±‚æˆ–å¸Œæœ›æ·±åº¦å®šåˆ¶AIèƒ½åŠ›çš„ä¼ä¸šåœºæ™¯ã€‚

---

## ğŸ¨ äº§å“åŠŸèƒ½è®¾è®¡

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 1ï¸âƒ£ æ™ºèƒ½æ–‡æ¡£é—®ç­”
```
ç”¨æˆ·è¾“å…¥ï¼š
"ä¹‹å‰ç”¨æˆ·ç™»å½•åŠŸèƒ½çš„éªŒè¯ç æœ‰æ•ˆæœŸæ˜¯å¤šå°‘ï¼Ÿ"

AIåŠ©æ‰‹å›ç­”ï¼š
ğŸ“„ æ ¹æ® v2.3 äº§å“éœ€æ±‚æ–‡æ¡£ (2024-03-15)ï¼š
ç”¨æˆ·ç™»å½•éªŒè¯ç æœ‰æ•ˆæœŸè®¾å®šä¸º 5åˆ†é’Ÿ
ç›¸å…³æˆªå›¾ï¼š[éªŒè¯ç æµç¨‹å›¾]
è´Ÿè´£äººï¼š@å¼ ä¸‰ 
å…³è”éœ€æ±‚ï¼šPRD-001-ç”¨æˆ·è®¤è¯æ¨¡å—

ğŸ”— ç›¸å…³æ–‡æ¡£é“¾æ¥ï¼š
- ç”¨æˆ·è®¤è¯è¯¦ç»†è®¾è®¡ v2.3.pdf
- ç™»å½•æµç¨‹ä¼˜åŒ–æ–¹æ¡ˆ v1.2.docx
```

#### 2ï¸âƒ£ æ–‡æ¡£ç‰ˆæœ¬å¯¹æ¯”
```
ç”¨æˆ·è¾“å…¥ï¼š
"æ”¯ä»˜æ¨¡å—åœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ"

AIåŠ©æ‰‹å›ç­”ï¼š
ğŸ“ˆ æ”¯ä»˜æ¨¡å—ç‰ˆæœ¬å˜æ›´å†å²ï¼š

v3.1 (2024-04-10):
âœ… æ–°å¢å¾®ä¿¡æ”¯ä»˜
âœ… ä¼˜åŒ–æ”¯ä»˜è¶…æ—¶å¤„ç†

v3.0 (2024-03-20): 
âœ… æ”¯æŒæ”¯ä»˜å®
âŒ ç§»é™¤é“¶è¡Œå¡ç›´è¿

v2.8 (2024-02-15):
âœ… æ·»åŠ æ”¯ä»˜çŠ¶æ€å›è°ƒæœºåˆ¶
```

#### 3ï¸âƒ£ éœ€æ±‚å…³è”åˆ†æ
```
ç”¨æˆ·è¾“å…¥ï¼š
"è¿™ä¸ªåŠŸèƒ½ä¼šå½±å“åˆ°å“ªäº›å…¶ä»–æ¨¡å—ï¼Ÿ"

AIåŠ©æ‰‹åˆ†æï¼š
ğŸ”— å…³è”å½±å“åˆ†æï¼š

ç›´æ¥å½±å“ï¼š
- ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ï¼ˆç”¨æˆ·çŠ¶æ€åŒæ­¥ï¼‰
- é€šçŸ¥æ¨¡å—ï¼ˆæ”¯ä»˜æˆåŠŸé€šçŸ¥ï¼‰

é—´æ¥å½±å“ï¼š
- è®¢å•æ¨¡å—ï¼ˆçŠ¶æ€æ›´æ–°é€»è¾‘ï¼‰
- æŠ¥è¡¨æ¨¡å—ï¼ˆè´¢åŠ¡ç»Ÿè®¡ï¼‰

å»ºè®®è¯„ä¼°ï¼š
âš ï¸  éœ€è¦åŒæ­¥æ›´æ–°ç”¨æˆ·ä¸­å¿ƒAPI
âš ï¸  é€šçŸ¥æ¨¡æ¿éœ€è¦æ·»åŠ æ–°å­—æ®µ
```

#### 4ï¸âƒ£ å®æ—¶æ–‡æ¡£ç›‘æ§
- ğŸ“ ç›‘æ§æŒ‡å®šç›®å½•çš„æ–‡æ¡£å˜æ›´
- ğŸ”„ è‡ªåŠ¨è§£ææ–°å¢/ä¿®æ”¹çš„æ–‡æ¡£
- ğŸ“Š å¢é‡æ›´æ–°å‘é‡åº“
- ğŸ“¢ é€šè¿‡é£ä¹¦æ¨é€å˜æ›´é€šçŸ¥

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é£ä¹¦ä¼ä¸šæ–‡æ¡£æº  â”‚    â”‚   Einoå¤„ç†å¼•æ“   â”‚    â”‚   ç”¨æˆ·äº¤äº’å±‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ é£ä¹¦æ–‡æ¡£API   â”‚â”€â”€â”€â–¶â”‚ â€¢ Transformer   â”‚â”€â”€â”€â–¶â”‚ â€¢ Webæ§åˆ¶å°     â”‚
â”‚ â€¢ å¤šç»´è¡¨æ ¼API   â”‚    â”‚ â€¢ Embedder      â”‚    â”‚ â€¢ é£ä¹¦æœºå™¨äºº     â”‚
â”‚ â€¢ çŸ¥è¯†åº“API     â”‚    â”‚ â€¢ Indexer       â”‚    â”‚ â€¢ é£ä¹¦å°ç¨‹åº     â”‚
â”‚ â€¢ Webhookç›‘å¬   â”‚    â”‚ â€¢ Retriever     â”‚    â”‚ â€¢ APIæ¥å£       â”‚
â”‚ â€¢ æƒé™åŒæ­¥      â”‚    â”‚ â€¢ ChatModel     â”‚    â”‚ â€¢ ç§»åŠ¨ç«¯åº”ç”¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å­˜å‚¨å±‚        â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ Milvuså‘é‡åº“  â”‚
                    â”‚ â€¢ MySQLå…ƒæ•°æ®   â”‚
                    â”‚ â€¢ Redisç¼“å­˜     â”‚
                    â”‚ â€¢ é£ä¹¦Tokenç¼“å­˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯ç»„ä»¶

#### ğŸš€ é£ä¹¦æ–‡æ¡£é›†æˆå±‚
```go
package feishu

import (
    "context"
    "encoding/json"
    "fmt"
    "log"
    "net/http"
    "time"
    
    "github.com/cloudwego/eino/chain"
    "github.com/cloudwego/eino/compose"
)

// é£ä¹¦APIå®¢æˆ·ç«¯
type FeishuDocClient struct {
    AppID       string
    AppSecret   string
    AccessToken string
    BaseURL     string
    HTTPClient  *http.Client
}

// æ–‡æ¡£ä¿¡æ¯ç»“æ„ä½“
type DocumentInfo struct {
    Token      string    `json:"token"`
    Type       string    `json:"type"`
    Title      string    `json:"title"`
    URL        string    `json:"url"`
    Owner      string    `json:"owner"`
    CreateTime time.Time `json:"create_time"`
    UpdateTime time.Time `json:"update_time"`
}

// æ–‡æ¡£å†…å®¹ç»“æ„ä½“
type DocumentContent struct {
    Content  string                 `json:"content"`
    Metadata map[string]interface{} `json:"metadata"`
}

// åˆ›å»ºé£ä¹¦APIå®¢æˆ·ç«¯
func NewFeishuDocClient(appID, appSecret string) *FeishuDocClient {
    client := &FeishuDocClient{
        AppID:     appID,
        AppSecret: appSecret,
        BaseURL:   "https://open.feishu.cn",
        HTTPClient: &http.Client{
            Timeout: 30 * time.Second,
        },
    }
    
    // è·å–è®¿é—®ä»¤ç‰Œ
    if err := client.refreshAccessToken(); err != nil {
        log.Printf("è·å–è®¿é—®ä»¤ç‰Œå¤±è´¥: %v", err)
    }
    
    return client
}

// è·å–æ‰€æœ‰å¯è®¿é—®çš„æ–‡æ¡£
func (c *FeishuDocClient) GetAllDocuments(ctx context.Context, folderToken string) ([]*DocumentInfo, error) {
    docTypes := []string{"doc", "sheet", "bitable", "wiki"}
    var allDocs []*DocumentInfo
    
    for _, docType := range docTypes {
        docs, err := c.fetchDocumentsByType(ctx, docType, folderToken)
        if err != nil {
            log.Printf("è·å– %s ç±»å‹æ–‡æ¡£å¤±è´¥: %v", docType, err)
            continue
        }
        allDocs = append(allDocs, docs...)
    }
    
    return allDocs, nil
}

// è·å–æ–‡æ¡£å…·ä½“å†…å®¹
func (c *FeishuDocClient) GetDocumentContent(ctx context.Context, docToken, docType string) (*DocumentContent, error) {
    switch docType {
    case "doc":
        return c.getDocContent(ctx, docToken)
    case "sheet":
        return c.getSheetContent(ctx, docToken)
    case "bitable":
        return c.getBitableContent(ctx, docToken)
    case "wiki":
        return c.getWikiContent(ctx, docToken)
    default:
        return nil, fmt.Errorf("ä¸æ”¯æŒçš„æ–‡æ¡£ç±»å‹: %s", docType)
    }
}

// è®¾ç½®Webhookç›‘å¬
func (c *FeishuDocClient) SetupWebhook(ctx context.Context, callbackURL string) error {
    events := []string{
        "drive.file.created_in_folder_v1",
        "drive.file.edit_v1", 
        "drive.file.title_updated_v1",
        "drive.file.trashed_v1",
    }
    
    for _, event := range events {
        if err := c.subscribeEvent(ctx, event, callbackURL); err != nil {
            log.Printf("è®¢é˜…äº‹ä»¶ %s å¤±è´¥: %v", event, err)
        }
    }
    
    return nil
}

// é£ä¹¦æ–‡æ¡£åŒæ­¥å™¨
type FeishuDocumentSyncer struct {
    client   *FeishuDocClient
    pipeline compose.Chain
}

// åˆ›å»ºæ–‡æ¡£åŒæ­¥å™¨
func NewFeishuDocumentSyncer(client *FeishuDocClient, pipeline compose.Chain) *FeishuDocumentSyncer {
    return &FeishuDocumentSyncer{
        client:   client,
        pipeline: pipeline,
    }
}

// å…¨é‡åŒæ­¥æ‰€æœ‰æ–‡æ¡£
func (s *FeishuDocumentSyncer) SyncAllDocuments(ctx context.Context) error {
    documents, err := s.client.GetAllDocuments(ctx, "")
    if err != nil {
        return fmt.Errorf("è·å–æ–‡æ¡£åˆ—è¡¨å¤±è´¥: %w", err)
    }
    
    for _, doc := range documents {
        if err := s.syncSingleDocument(ctx, doc); err != nil {
            log.Printf("åŒæ­¥æ–‡æ¡£å¤±è´¥ %s: %v", doc.Title, err)
            continue
        }
        log.Printf("åŒæ­¥æ–‡æ¡£æˆåŠŸ: %s", doc.Title)
    }
    
    return nil
}

// åŒæ­¥å•ä¸ªæ–‡æ¡£
func (s *FeishuDocumentSyncer) syncSingleDocument(ctx context.Context, doc *DocumentInfo) error {
    content, err := s.client.GetDocumentContent(ctx, doc.Token, doc.Type)
    if err != nil {
        return fmt.Errorf("è·å–æ–‡æ¡£å†…å®¹å¤±è´¥: %w", err)
    }
    
    // æ„å»ºå¤„ç†è¾“å…¥
    input := map[string]interface{}{
        "content": content.Content,
        "metadata": map[string]interface{}{
            "doc_token":   doc.Token,
            "doc_type":    doc.Type,
            "title":       doc.Title,
            "url":         doc.URL,
            "owner":       doc.Owner,
            "create_time": doc.CreateTime,
            "update_time": doc.UpdateTime,
            "source":      "feishu",
        },
    }
    
    // ä½¿ç”¨Einoå¤„ç†æ–‡æ¡£
    _, err = s.pipeline.Invoke(ctx, input)
    return err
}
```

#### ğŸ“„ æ–‡æ¡£å¤„ç†æµæ°´çº¿
```go
package pipeline

import (
    "context"
    
    "github.com/cloudwego/eino/chain"
    "github.com/cloudwego/eino/compose"
    "github.com/cloudwego/eino/components/document"
    "github.com/cloudwego/eino/components/embedding" 
    "github.com/cloudwego/eino/components/indexing"
)

// åˆ›å»ºä¸“é—¨é€‚é…é£ä¹¦æ–‡æ¡£çš„å¤„ç†æµæ°´çº¿
func NewFeishuDocumentPipeline() compose.Chain {
    // æ–‡æ¡£åŠ è½½å™¨
    docLoader := document.NewDocumentLoader(document.Config{
        ChunkSize:    512,
        ChunkOverlap: 50,
        PreserveStructure: true, // ä¿æŒé£ä¹¦æ–‡æ¡£ç»“æ„
    })
    
    // å†…å®¹åˆ†å‰²å™¨
    splitter := document.NewTextSplitter(document.SplitterConfig{
        ChunkSize:    512,
        ChunkOverlap: 50,
        Separators:   []string{"\n\n", "\n", "ã€‚", ".", " "},
    })
    
    // å‘é‡åµŒå…¥å™¨
    embedder := embedding.NewEmbedding(embedding.Config{
        Provider: "openai",
        Model:    "text-embedding-ada-002",
        APIKey:   os.Getenv("OPENAI_API_KEY"),
    })
    
    // å‘é‡ç´¢å¼•å™¨
    indexer := indexing.NewMilvusIndexer(indexing.MilvusConfig{
        Host:           "localhost:19530",
        CollectionName: "feishu_docs",
        Dimension:      1536,
        IndexType:      "IVF_FLAT",
        MetricType:     "L2",
    })
    
    // æ„å»ºå¤„ç†é“¾
    pipeline := compose.NewChain().
        AppendRunnable(docLoader).
        AppendRunnable(splitter).
        AppendRunnable(embedder).
        AppendRunnable(indexer)
    
    return pipeline
}

// é£ä¹¦æ–‡æ¡£å†…å®¹è§£æå™¨
type FeishuContentParser struct{}

func NewFeishuContentParser() *FeishuContentParser {
    return &FeishuContentParser{}
}

func (p *FeishuContentParser) Invoke(ctx context.Context, input map[string]interface{}) (map[string]interface{}, error) {
    content, ok := input["content"].(string)
    if !ok {
        return input, fmt.Errorf("invalid content type")
    }
    
    docType, _ := input["metadata"].(map[string]interface{})["doc_type"].(string)
    
    var parsedContent string
    var err error
    
    switch docType {
    case "doc":
        parsedContent, err = p.parseFeishuDoc(content)
    case "sheet":
        parsedContent, err = p.parseFeishuSheet(content)
    case "bitable":
        parsedContent, err = p.parseFeishuBitable(content)
    case "wiki":
        parsedContent, err = p.parseFeishuWiki(content)
    default:
        parsedContent = content
    }
    
    if err != nil {
        return input, err
    }
    
    input["parsed_content"] = parsedContent
    return input, nil
}

// è§£æé£ä¹¦æ–‡æ¡£
func (p *FeishuContentParser) parseFeishuDoc(content string) (string, error) {
    // è§£æé£ä¹¦æ–‡æ¡£çš„ç‰¹æ®Šæ ¼å¼
    // å¤„ç†æ ‡é¢˜ã€æ®µè½ã€è¡¨æ ¼ã€ä»£ç å—ç­‰
    return content, nil
}

// æ”¯æŒçš„é£ä¹¦æ–‡æ¡£ç±»å‹
/*
- é£ä¹¦æ–‡æ¡£ (Doc) - å¯Œæ–‡æœ¬æ–‡æ¡£ï¼Œæ”¯æŒæ ‡é¢˜ã€æ®µè½ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰
- é£ä¹¦è¡¨æ ¼ (Sheet) - æ•°æ®è¡¨æ ¼ï¼Œè‡ªåŠ¨æå–å•å…ƒæ ¼å†…å®¹ 
- å¤šç»´è¡¨æ ¼ (Bitable) - ç»“æ„åŒ–æ•°æ®ï¼Œæ”¯æŒå­—æ®µç±»å‹è¯†åˆ«
- é£ä¹¦çŸ¥è¯†åº“ (Wiki) - çŸ¥è¯†åº“é¡µé¢ï¼Œä¿æŒé¡µé¢å±‚çº§ç»“æ„
- æ€ç»´å¯¼å›¾ (MindMap) - æµç¨‹å›¾è¡¨ï¼Œæå–èŠ‚ç‚¹å’Œå…³ç³»ä¿¡æ¯
*/
```

#### ğŸ” æ™ºèƒ½æ£€ç´¢å¼•æ“
```go
package retrieval

import (
    "context"
    
    "github.com/cloudwego/eino/compose"
    "github.com/cloudwego/eino/components/retriever"
    "github.com/cloudwego/eino/components/model"
    "github.com/cloudwego/eino/components/prompt"
)

// åˆ›å»ºRAGæ£€ç´¢é“¾
func NewDocumentQAChain() compose.Chain {
    // æŸ¥è¯¢åˆ†æå™¨
    queryAnalyzer := NewQueryAnalyzer()
    
    // è¯­ä¹‰æ£€ç´¢å™¨
    semanticRetriever := retriever.NewVectorRetriever(retriever.Config{
        Collection:      "feishu_docs",
        TopK:           5,
        ScoreThreshold: 0.7,
        SearchParams: map[string]interface{}{
            "nprobe": 10,
        },
    })
    
    // ç›¸å…³æ€§è¿‡æ»¤å™¨
    relevanceFilter := NewRelevanceFilter()
    
    // ä¸Šä¸‹æ–‡èšåˆå™¨
    contextAggregator := NewContextAggregator()
    
    // å¯¹è¯æ¨¡å‹
    chatModel := model.NewChatModel(model.Config{
        Provider:    "openai",
        Model:       "gpt-4",
        Temperature: 0.1,
        MaxTokens:   2000,
    })
    
    // æ„å»ºæ£€ç´¢é“¾
    chain := compose.NewChain().
        AppendRunnable(queryAnalyzer).
        AppendRunnable(semanticRetriever).
        AppendRunnable(relevanceFilter).
        AppendRunnable(contextAggregator).
        AppendRunnable(chatModel)
    
    return chain
}

// æŸ¥è¯¢åˆ†æå™¨
type QueryAnalyzer struct{}

func NewQueryAnalyzer() *QueryAnalyzer {
    return &QueryAnalyzer{}
}

func (q *QueryAnalyzer) Invoke(ctx context.Context, input map[string]interface{}) (map[string]interface{}, error) {
    query := input["query"].(string)
    
    // åˆ†ææŸ¥è¯¢æ„å›¾
    intent := q.analyzeIntent(query)
    
    // æå–å…³é”®è¯
    keywords := q.extractKeywords(query)
    
    // æ£€æµ‹æ—¶é—´èŒƒå›´
    timeRange := q.detectTimeRange(query)
    
    // è¯†åˆ«æ–‡æ¡£ç±»å‹åå¥½
    docTypePreference := q.detectDocTypePreference(query)
    
    input["analyzed_query"] = map[string]interface{}{
        "original_query":      query,
        "intent":              intent,
        "keywords":            keywords,
        "time_range":          timeRange,
        "doc_type_preference": docTypePreference,
    }
    
    return input, nil
}

// æ–‡æ¡£é—®ç­”ç³»ç»Ÿ
type DocumentQASystem struct {
    qaChain compose.Chain
}

func NewDocumentQASystem() *DocumentQASystem {
    return &DocumentQASystem{
        qaChain: NewDocumentQAChain(),
    }
}

func (qa *DocumentQASystem) Ask(ctx context.Context, question string) (string, error) {
    input := map[string]interface{}{
        "query": question,
    }
    
    result, err := qa.qaChain.Invoke(ctx, input)
    if err != nil {
        return "", err
    }
    
    answer, ok := result["answer"].(string)
    if !ok {
        return "", fmt.Errorf("invalid answer format")
    }
    
    return answer, nil
}

// æ£€ç´¢ç­–ç•¥é…ç½®
/*
æ£€ç´¢ç­–ç•¥ï¼š
- è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆä¸»è¦ï¼‰: ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦åŒ¹é…
- å…³é”®è¯åŒ¹é…æ£€ç´¢ï¼ˆè¾…åŠ©ï¼‰: è¡¥å……ä¼ ç»Ÿæ–‡æœ¬åŒ¹é…  
- æ—¶é—´èŒƒå›´è¿‡æ»¤: æ”¯æŒ"æœ€è¿‘ä¸€ä¸ªæœˆ"ç­‰æ—¶é—´æŸ¥è¯¢
- æ–‡æ¡£ç±»å‹è¿‡æ»¤: å¯æŒ‡å®šæŸ¥è¯¢ç‰¹å®šç±»å‹æ–‡æ¡£
- ä½œè€…/è´Ÿè´£äººè¿‡æ»¤: æŒ‰æ–‡æ¡£åˆ›å»ºè€…æˆ–è´Ÿè´£äººç­›é€‰
- æƒé™æ£€æŸ¥: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®æœ‰æƒé™çš„æ–‡æ¡£
*/
```

#### ğŸ”„ é£ä¹¦å®æ—¶æ›´æ–°æœºåˆ¶
```go
package webhook

import (
    "context"
    "encoding/json"
    "fmt"
    "log"
    "net/http"
    "time"
    
    "github.com/gin-gonic/gin"
)

// é£ä¹¦äº‹ä»¶æ•°æ®ç»“æ„
type FeishuEvent struct {
    Schema string `json:"schema"`
    Header struct {
        EventID    string `json:"event_id"`
        EventType  string `json:"event_type"`
        CreateTime string `json:"create_time"`
        Token      string `json:"token"`
        AppID      string `json:"app_id"`
        TenantKey  string `json:"tenant_key"`
    } `json:"header"`
    Event map[string]interface{} `json:"event"`
}

// é£ä¹¦Webhookç›‘å¬å™¨
type FeishuWebhookListener struct {
    syncer   *FeishuDocumentSyncer
    notifier *FeishuNotifier
    server   *gin.Engine
}

func NewFeishuWebhookListener(syncer *FeishuDocumentSyncer, notifier *FeishuNotifier) *FeishuWebhookListener {
    listener := &FeishuWebhookListener{
        syncer:   syncer,
        notifier: notifier,
        server:   gin.Default(),
    }
    
    // è®¾ç½®è·¯ç”±
    listener.setupRoutes()
    
    return listener
}

func (l *FeishuWebhookListener) setupRoutes() {
    l.server.POST("/webhook/feishu", l.handleWebhook)
}

func (l *FeishuWebhookListener) handleWebhook(c *gin.Context) {
    var event FeishuEvent
    if err := c.ShouldBindJSON(&event); err != nil {
        log.Printf("è§£æwebhookæ•°æ®å¤±è´¥: %v", err)
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }
    
    // éªŒè¯äº‹ä»¶åˆæ³•æ€§
    if !l.validateEvent(&event) {
        log.Printf("äº‹ä»¶éªŒè¯å¤±è´¥: %s", event.Header.EventID)
        c.JSON(http.StatusUnauthorized, gin.H{"error": "invalid event"})
        return
    }
    
    // å¤„ç†æ–‡æ¡£äº‹ä»¶
    go l.handleDocumentEvent(context.Background(), &event)
    
    c.JSON(http.StatusOK, gin.H{"challenge": event.Event["challenge"]})
}

func (l *FeishuWebhookListener) handleDocumentEvent(ctx context.Context, event *FeishuEvent) {
    switch event.Header.EventType {
    case "drive.file.edit_v1", "drive.file.title_updated_v1":
        l.handleDocumentUpdate(ctx, event)
    case "drive.file.created_in_folder_v1":
        l.handleDocumentCreate(ctx, event)
    case "drive.file.trashed_v1":
        l.handleDocumentDelete(ctx, event)
    default:
        log.Printf("æœªå¤„ç†çš„äº‹ä»¶ç±»å‹: %s", event.Header.EventType)
    }
}

func (l *FeishuWebhookListener) handleDocumentUpdate(ctx context.Context, event *FeishuEvent) {
    docToken, ok := event.Event["file_token"].(string)
    if !ok {
        log.Printf("æ— æ•ˆçš„æ–‡æ¡£token")
        return
    }
    
    docType, _ := event.Event["file_type"].(string)
    
    // é‡æ–°åŒæ­¥æ–‡æ¡£
    doc := &DocumentInfo{
        Token: docToken,
        Type:  docType,
    }
    
    if err := l.syncer.syncSingleDocument(ctx, doc); err != nil {
        log.Printf("åŒæ­¥æ–‡æ¡£å¤±è´¥ %s: %v", docToken, err)
        return
    }
    
    // å‘é€æ›´æ–°é€šçŸ¥
    l.sendUpdateNotification(event)
}

func (l *FeishuWebhookListener) handleDocumentCreate(ctx context.Context, event *FeishuEvent) {
    // å¤„ç†æ–°æ–‡æ¡£åˆ›å»º
    l.handleDocumentUpdate(ctx, event)
}

func (l *FeishuWebhookListener) handleDocumentDelete(ctx context.Context, event *FeishuEvent) {
    docToken, ok := event.Event["file_token"].(string)
    if !ok {
        return
    }
    
    // ä»å‘é‡åº“ä¸­åˆ é™¤ç›¸å…³æ–‡æ¡£
    // è¿™é‡Œéœ€è¦å®ç°åˆ é™¤é€»è¾‘
    log.Printf("æ–‡æ¡£å·²åˆ é™¤: %s", docToken)
}

func (l *FeishuWebhookListener) sendUpdateNotification(event *FeishuEvent) {
    docInfo := map[string]interface{}{
        "title":       event.Event["file_name"],
        "update_time": time.Now().Format("2006-01-02 15:04:05"),
        "operator":    event.Event["operator_id"],
        "doc_token":   event.Event["file_token"],
        "doc_url":     fmt.Sprintf("https://bytedance.feishu.cn/docs/%s", event.Event["file_token"]),
    }
    
    l.notifier.SendDocumentUpdateNotification(docInfo)
}

func (l *FeishuWebhookListener) Start(addr string) error {
    log.Printf("å¯åŠ¨Webhookç›‘å¬å™¨ï¼Œåœ°å€: %s", addr)
    return l.server.Run(addr)
}

// æƒé™åŒæ­¥å™¨
type FeishuPermissionSyncer struct {
    client *FeishuDocClient
}

func NewFeishuPermissionSyncer(client *FeishuDocClient) *FeishuPermissionSyncer {
    return &FeishuPermissionSyncer{
        client: client,
    }
}

type DocumentPermission struct {
    DocToken  string    `json:"doc_token"`
    Viewers   []string  `json:"viewers"`
    Editors   []string  `json:"editors"`
    Owners    []string  `json:"owners"`
    UpdatedAt time.Time `json:"updated_at"`
}

func (s *FeishuPermissionSyncer) SyncDocumentPermissions(ctx context.Context, docToken string) (*DocumentPermission, error) {
    permissions, err := s.client.getDocumentPermissions(ctx, docToken)
    if err != nil {
        return nil, fmt.Errorf("è·å–æ–‡æ¡£æƒé™å¤±è´¥: %w", err)
    }
    
    permissionCache := &DocumentPermission{
        DocToken:  docToken,
        Viewers:   permissions["viewers"].([]string),
        Editors:   permissions["editors"].([]string),
        Owners:    permissions["owners"].([]string),
        UpdatedAt: time.Now(),
    }
    
    // ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
    if err := s.savePermissionCache(permissionCache); err != nil {
        log.Printf("ä¿å­˜æƒé™ç¼“å­˜å¤±è´¥: %v", err)
    }
    
    return permissionCache, nil
}

func (s *FeishuPermissionSyncer) savePermissionCache(permission *DocumentPermission) error {
    // å®ç°æƒé™ç¼“å­˜ä¿å­˜é€»è¾‘
    // å¯ä»¥ä¿å­˜åˆ° Redis æˆ–æ•°æ®åº“ä¸­
    return nil
}
```

---

## ğŸ” å¼€å‘åˆæœŸæƒé™å—é™è§£å†³æ–¹æ¡ˆ

### å¼€å‘åˆæœŸç¼ºä¹æ–‡æ¡£æƒé™çš„æ¸è¿›å¼ç­–ç•¥

åœ¨é¡¹ç›®å¼€å‘åˆæœŸï¼Œç”±äºå®‰å…¨è€ƒè™‘æˆ–å®¡æ‰¹æµç¨‹ï¼Œå¯èƒ½æ— æ³•ç«‹å³è·å¾—å…¬å¸å…¨é‡æ–‡æ¡£æƒé™ã€‚ä»¥ä¸‹æ˜¯ç»è¿‡å®è·µéªŒè¯çš„æ¸è¿›å¼è§£å†³æ–¹æ¡ˆï¼š

#### ğŸš€ **Phase 0: æœ€å°å¯è¡Œæ€§éªŒè¯ï¼ˆMVPï¼‰**

##### 1. **ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œå¼€å‘** ğŸ“‹
```go
// åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå™¨
type MockDataGenerator struct {
    documents []Document
}

func NewMockDataGenerator() *MockDataGenerator {
    return &MockDataGenerator{
        documents: []Document{
            {
                ID: "mock-doc-001",
                Title: "ç”¨æˆ·ç™»å½•åŠŸèƒ½éœ€æ±‚æ–‡æ¡£ v2.3",
                Content: "ç”¨æˆ·ç™»å½•éªŒè¯ç æœ‰æ•ˆæœŸè®¾å®šä¸º5åˆ†é’Ÿï¼Œè¶…æ—¶åéœ€é‡æ–°è·å–ã€‚æ”¯æŒçŸ­ä¿¡å’Œé‚®ç®±ä¸¤ç§æ–¹å¼...",
                Version: "v2.3",
                CreatedAt: time.Now().AddDate(0, -3, 0),
                Author: "å¼ ä¸‰",
                Department: "äº§å“éƒ¨",
                Tags: []string{"ç”¨æˆ·è®¤è¯", "ç™»å½•", "éªŒè¯ç "},
                DocumentType: "PRD",
            },
            {
                ID: "mock-doc-002", 
                Title: "æ”¯ä»˜æ¨¡å—æŠ€æœ¯è®¾è®¡æ–‡æ¡£ v1.5",
                Content: "æ”¯ä»˜æ¨¡å—é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ç­‰å¤šç§æ”¯ä»˜æ–¹å¼...",
                Version: "v1.5",
                CreatedAt: time.Now().AddDate(0, -2, -15),
                Author: "æå››",
                Department: "æŠ€æœ¯éƒ¨",
                Tags: []string{"æ”¯ä»˜", "å¾®æœåŠ¡", "æ¶æ„è®¾è®¡"},
                DocumentType: "TDD",
            },
            // æ›´å¤šæ¨¡æ‹Ÿæ–‡æ¡£...
        },
    }
}

func (mdg *MockDataGenerator) GetMockDocuments() []Document {
    return mdg.documents
}

func (mdg *MockDataGenerator) AddMockDocument(doc Document) {
    mdg.documents = append(mdg.documents, doc)
}
```

##### 2. **åˆ›å»ºæƒé™åˆ†çº§çš„å¼€å‘ç­–ç•¥** ğŸ”
```go
type PermissionLevel int

const (
    MockData PermissionLevel = iota  // ä»…æ¨¡æ‹Ÿæ•°æ®
    TestDocs                         // æµ‹è¯•æ–‡æ¡£  
    TeamDocs                         // å›¢é˜Ÿæ–‡æ¡£
    ProjectDocs                      // é¡¹ç›®æ–‡æ¡£
    FullAccess                       // å…¨é‡æ•°æ®
)

type DocumentService struct {
    permissionLevel PermissionLevel
    mockGenerator   *MockDataGenerator
    feishuClient    *feishu.Client
    config          *Config
}

func (ds *DocumentService) GetDocuments(ctx context.Context, query string) ([]Document, error) {
    switch ds.permissionLevel {
    case MockData:
        log.Printf("ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å“åº”æŸ¥è¯¢: %s", query)
        return ds.mockGenerator.GetMockDocuments(), nil
    case TestDocs:
        return ds.getTestDocuments(ctx, query)
    case TeamDocs:
        return ds.getTeamDocuments(ctx, query) 
    case ProjectDocs:
        return ds.getProjectDocuments(ctx, query)
    case FullAccess:
        return ds.getAllDocuments(ctx, query)
    default:
        return ds.mockGenerator.GetMockDocuments(), nil
    }
}

func (ds *DocumentService) UpgradePermissionLevel(newLevel PermissionLevel) error {
    if newLevel <= ds.permissionLevel {
        return fmt.Errorf("æƒé™ç­‰çº§åªèƒ½å‡çº§ï¼Œä¸èƒ½é™çº§")
    }
    
    log.Printf("æƒé™å‡çº§: %v -> %v", ds.permissionLevel, newLevel)
    ds.permissionLevel = newLevel
    
    // è§¦å‘é‡æ–°ç´¢å¼•
    return ds.reindexWithNewPermission()
}
```

#### ğŸ“ **Phase 1: ä¸ªäºº/æµ‹è¯•æ–‡æ¡£éªŒè¯**

##### 1. **åˆ›å»ºä¸“ç”¨æµ‹è¯•ç¯å¢ƒ** ğŸ 
```go
// æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–
func SetupTestEnvironment(feishuClient *feishu.Client) error {
    testWorkspace := &TestWorkspace{
        Name: "AIåŠ©æ‰‹å¼€å‘æµ‹è¯•ç©ºé—´",
        Description: "ç”¨äºAIæ–‡æ¡£åŠ©æ‰‹åŠŸèƒ½éªŒè¯çš„æµ‹è¯•ç¯å¢ƒ",
    }
    
    // åˆ›å»ºæµ‹è¯•æ–‡æ¡£é›†
    testDocs := []TestDocument{
        {
            Name: "äº§å“éœ€æ±‚æ–‡æ¡£æ¨¡æ¿.docx", 
            Category: "PRD",
            Content: generateMockPRDContent(),
            Tags: []string{"æ¨¡æ¿", "éœ€æ±‚", "äº§å“"},
        },
        {
            Name: "æŠ€æœ¯è®¾è®¡æ–‡æ¡£æ¨¡æ¿.md", 
            Category: "TDD",
            Content: generateMockTDDContent(),
            Tags: []string{"æŠ€æœ¯", "è®¾è®¡", "æ¶æ„"},
        },
        {
            Name: "ç”¨æˆ·æ•…äº‹é›†åˆ.pdf", 
            Category: "UserStory",
            Content: generateMockUserStoryContent(),
            Tags: []string{"ç”¨æˆ·æ•…äº‹", "éœ€æ±‚", "åœºæ™¯"},
        },
        {
            Name: "APIæ¥å£æ–‡æ¡£.xlsx", 
            Category: "API",
            Content: generateMockAPIContent(),
            Tags: []string{"API", "æ¥å£", "æ–‡æ¡£"},
        },
    }
    
    for _, doc := range testDocs {
        if err := createTestDocument(feishuClient, testWorkspace, doc); err != nil {
            return fmt.Errorf("åˆ›å»ºæµ‹è¯•æ–‡æ¡£å¤±è´¥ %s: %v", doc.Name, err)
        }
        log.Printf("âœ… åˆ›å»ºæµ‹è¯•æ–‡æ¡£: %s", doc.Name)
    }
    
    return nil
}

// ç”Ÿæˆæ¨¡æ‹Ÿæ–‡æ¡£å†…å®¹
func generateMockPRDContent() string {
    return `
# äº§å“éœ€æ±‚æ–‡æ¡£ - ç”¨æˆ·è®¤è¯æ¨¡å—

## 1. éœ€æ±‚æ¦‚è¿°
è®¾è®¡ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€å¯†ç é‡ç½®åŠŸèƒ½

## 2. åŠŸèƒ½è¯¦è¿°
### 2.1 ç”¨æˆ·ç™»å½•
- æ”¯æŒæ‰‹æœºå·/é‚®ç®±ç™»å½•
- éªŒè¯ç æœ‰æ•ˆæœŸ: 5åˆ†é’Ÿ
- ç™»å½•å¤±è´¥é”å®š: è¿ç»­5æ¬¡å¤±è´¥é”å®š30åˆ†é’Ÿ

### 2.2 ç”¨æˆ·æ³¨å†Œ  
- å®åè®¤è¯è¦æ±‚
- æ‰‹æœºå·å”¯ä¸€æ€§æ ¡éªŒ
- å¯†ç å¼ºåº¦è¦æ±‚: 8-20ä½ï¼ŒåŒ…å«æ•°å­—ã€å­—æ¯

## 3. éåŠŸèƒ½éœ€æ±‚
- å“åº”æ—¶é—´: <500ms
- å¹¶å‘æ”¯æŒ: 1000 TPS
- å¯ç”¨æ€§: 99.9%
`
}
```

##### 2. **æ¸è¿›å¼æƒé™ç”³è¯·è·¯çº¿å›¾** ğŸ“‹
```go
type PermissionPlan struct {
    Phases []PermissionPhase
    CurrentPhase int
    TotalEstimatedTime time.Duration
}

type PermissionPhase struct {
    Name         string
    Duration     string  
    Scope        string
    Goal         string
    Prerequisites []string
    Deliverables []string
    SuccessMetrics []string
}

func NewPermissionPlan() *PermissionPlan {
    return &PermissionPlan{
        Phases: []PermissionPhase{
            {
                Name: "ä¸ªäººéªŒè¯é˜¶æ®µ",
                Duration: "1-2å‘¨",
                Scope: "ä¸ªäººåˆ›å»ºçš„æµ‹è¯•æ–‡æ¡£ï¼ˆçº¦10-20ä¸ªæ–‡æ¡£ï¼‰",
                Goal: "éªŒè¯æŠ€æœ¯å¯è¡Œæ€§å’ŒåŸºç¡€åŠŸèƒ½",
                Prerequisites: []string{
                    "å®ŒæˆæŠ€æœ¯æ¶æ„è®¾è®¡",
                    "æ­å»ºå¼€å‘ç¯å¢ƒ",
                    "å‡†å¤‡æ¨¡æ‹Ÿæ•°æ®",
                },
                Deliverables: []string{
                    "MVPåŠŸèƒ½æ¼”ç¤º",
                    "æŠ€æœ¯å¯è¡Œæ€§æŠ¥å‘Š",
                    "æ€§èƒ½æµ‹è¯•ç»“æœ",
                },
                SuccessMetrics: []string{
                    "æŸ¥è¯¢å“åº”æ—¶é—´ < 2ç§’",
                    "ç­”æ¡ˆå‡†ç¡®ç‡ > 80%",
                    "ç³»ç»Ÿç¨³å®šè¿è¡Œ",
                },
            },
            {
                Name: "å›¢é˜Ÿè¯•ç‚¹é˜¶æ®µ",
                Duration: "2-3å‘¨", 
                Scope: "æ‰€åœ¨å›¢é˜Ÿçš„é¡¹ç›®æ–‡æ¡£ï¼ˆçº¦50-100ä¸ªæ–‡æ¡£ï¼‰",
                Goal: "è¯æ˜ä¸šåŠ¡ä»·å€¼å’Œå›¢é˜Ÿåä½œæ•ˆæœ",
                Prerequisites: []string{
                    "ä¸ªäººé˜¶æ®µéªŒè¯é€šè¿‡",
                    "å›¢é˜ŸleaderåŒæ„",
                    "å®Œæˆå®‰å…¨è¯„ä¼°",
                },
                Deliverables: []string{
                    "å›¢é˜Ÿä½¿ç”¨æŠ¥å‘Š",
                    "æ•ˆç‡æå‡æ•°æ®",
                    "ç”¨æˆ·åé¦ˆæ”¶é›†",
                },
                SuccessMetrics: []string{
                    "å›¢é˜ŸæŸ¥æ‰¾æ•ˆç‡æå‡ > 60%",
                    "ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5.0",
                    "é›¶å®‰å…¨äº‹æ•…",
                },
            },
            {
                Name: "é¡¹ç›®æ‰©å±•é˜¶æ®µ",
                Duration: "3-4å‘¨",
                Scope: "ç›¸å…³é¡¹ç›®çš„å†å²æ–‡æ¡£ï¼ˆçº¦200-500ä¸ªæ–‡æ¡£ï¼‰", 
                Goal: "å±•ç¤ºå¤§è§„æ¨¡åº”ç”¨æ•ˆæœ",
                Prerequisites: []string{
                    "å›¢é˜Ÿè¯•ç‚¹æˆåŠŸ",
                    "é¡¹ç›®è´Ÿè´£äººæ‰¹å‡†",
                    "å®Œæˆåˆè§„å®¡æŸ¥",
                },
                Deliverables: []string{
                    "é¡¹ç›®çº§åº”ç”¨æŠ¥å‘Š",
                    "ROIè®¡ç®—ç»“æœ",
                    "æ‰©å±•æ€§éªŒè¯æŠ¥å‘Š",
                },
                SuccessMetrics: []string{
                    "æ–‡æ¡£æ£€ç´¢å‡†ç¡®ç‡ > 85%",
                    "æœˆåº¦ROI > 10,000å…ƒ",
                    "ç³»ç»Ÿè´Ÿè½½èƒ½åŠ›éªŒè¯",
                },
            },
            {
                Name: "å…¨é¢æ¨å¹¿é˜¶æ®µ",
                Duration: "æŒç»­ä¼˜åŒ–",
                Scope: "å…¬å¸å…¨é‡æ–‡æ¡£ï¼ˆ1000+æ–‡æ¡£ï¼‰",
                Goal: "ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œ",
                Prerequisites: []string{
                    "é¡¹ç›®æ‰©å±•æˆåŠŸ",
                    "å®‰å…¨éƒ¨é—¨æ‰¹å‡†",
                    "ITéƒ¨é—¨æ”¯æŒ",
                },
                Deliverables: []string{
                    "ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²",
                    "ç”¨æˆ·åŸ¹è®­ææ–™",
                    "è¿ç»´æ‰‹å†Œ",
                },
                SuccessMetrics: []string{
                    "å…¨å…¬å¸ä½¿ç”¨ç‡ > 70%",
                    "ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%",
                    "æŒç»­ä»·å€¼åˆ›é€ ",
                },
            },
        },
    }
}
```

#### ğŸ­ **Phase 2: æ¼”ç¤ºé©±åŠ¨çš„æƒé™è·å–**

##### 1. **åˆ›å»ºæœ‰è¯´æœåŠ›çš„æ¼”ç¤ºç”¨ä¾‹** ğŸ¬
```go
type DemoScenario struct {
    ID          string
    Name        string
    Description string
    UserQuery   string
    AIResponse  string
    Benefits    []string
    Metrics     DemoMetrics
}

type DemoMetrics struct {
    TraditionalSearchTime int // ä¼ ç»Ÿæœç´¢ç”¨æ—¶(åˆ†é’Ÿ)
    AISearchTime         int // AIæœç´¢ç”¨æ—¶(ç§’) 
    AccuracyImprovement  float64 // å‡†ç¡®ç‡æå‡
    ProductivityGain     float64 // æ•ˆç‡æå‡
}

var DemoScenarios = []DemoScenario{
    {
        ID: "scenario-001",
        Name: "å¿«é€Ÿéœ€æ±‚æŸ¥æ‰¾",
        Description: "æ¼”ç¤ºå¦‚ä½•åœ¨æµ·é‡æ–‡æ¡£ä¸­å¿«é€Ÿå®šä½å…·ä½“éœ€æ±‚ä¿¡æ¯",
        UserQuery: "ç”¨æˆ·ç™»å½•çš„éªŒè¯ç æœ‰æ•ˆæœŸæ˜¯å¤šå°‘ï¼Ÿä¹‹å‰æœ‰æ²¡æœ‰è°ƒæ•´è¿‡ï¼Ÿ",
        AIResponse: `ğŸ“‹ **æŸ¥è¯¢ç»“æœ**

ğŸ¯ **å½“å‰è§„åˆ™** (v2.3ç‰ˆæœ¬):
éªŒè¯ç æœ‰æ•ˆæœŸ: **5åˆ†é’Ÿ**

ğŸ“ˆ **å†å²å˜æ›´**:
- v1.0 (2023-08): éªŒè¯ç æœ‰æ•ˆæœŸ 3åˆ†é’Ÿ
- v2.0 (2023-12): è°ƒæ•´ä¸º 5åˆ†é’Ÿ (ç”¨æˆ·åé¦ˆ3åˆ†é’Ÿå¤ªçŸ­)
- v2.3 (2024-03): ä¿æŒ 5åˆ†é’Ÿï¼Œå¢åŠ é‡å‘æœºåˆ¶

ğŸ“„ **ç›¸å…³æ–‡æ¡£**:
- ã€Šç”¨æˆ·è®¤è¯æ¨¡å—éœ€æ±‚æ–‡æ¡£ v2.3ã€‹ - å¼ ä¸‰
- ã€Šç™»å½•ä½“éªŒä¼˜åŒ–æŠ¥å‘Šã€‹ - æå››  
- ã€ŠéªŒè¯ç ç³»ç»ŸæŠ€æœ¯å®ç°ã€‹ - ç‹äº”

ğŸ‘¤ **è´Ÿè´£äºº**: @å¼ ä¸‰ (äº§å“) @æå›› (å¼€å‘)`,
        Benefits: []string{
            "ä»10åˆ†é’Ÿæœç´¢ç¼©çŸ­åˆ°30ç§’",
            "è·å–å®Œæ•´ä¸Šä¸‹æ–‡ä¿¡æ¯",
            "è‡ªåŠ¨å…³è”ç›¸å…³æ–‡æ¡£",
            "è¿½æº¯å†å²å˜æ›´è®°å½•",
        },
        Metrics: DemoMetrics{
            TraditionalSearchTime: 10,
            AISearchTime:         30,
            AccuracyImprovement:  0.85,
            ProductivityGain:     0.95,
        },
    },
    {
        ID: "scenario-002", 
        Name: "è·¨ç‰ˆæœ¬éœ€æ±‚å¯¹æ¯”",
        Description: "æ™ºèƒ½å¯¹æ¯”ä¸åŒç‰ˆæœ¬é—´çš„éœ€æ±‚å˜åŒ–",
        UserQuery: "æ”¯ä»˜æ¨¡å—åœ¨æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬æœ‰ä»€ä¹ˆé‡è¦å˜åŒ–ï¼Ÿ",
        AIResponse: `ğŸ”„ **æ”¯ä»˜æ¨¡å—ç‰ˆæœ¬å˜æ›´åˆ†æ**

ğŸ“Š **ä¸»è¦å˜åŒ–æ€»è§ˆ**:
- v3.1 â†’ v3.2: æ–°å¢å¾®ä¿¡æ”¯ä»˜
- v3.2 â†’ v3.3: æ”¯æŒåˆ†æœŸä»˜æ¬¾  
- v3.3 â†’ v3.4: å¢å¼ºå®‰å…¨éªŒè¯

ğŸ“‹ **è¯¦ç»†å˜æ›´è®°å½•**:

**v3.4 (2024-03-01)**
- âœ¨ æ–°å¢: äººè„¸è¯†åˆ«æ”¯ä»˜éªŒè¯
- ğŸ”’ å¢å¼º: æ”¯ä»˜å¯†ç å¤æ‚åº¦è¦æ±‚
- ğŸ› ä¿®å¤: é«˜å¹¶å‘ä¸‹è®¢å•é‡å¤é—®é¢˜

**v3.3 (2024-01-15)** 
- âœ¨ æ–°å¢: åˆ†æœŸä»˜æ¬¾åŠŸèƒ½ (3/6/12æœŸ)
- âš¡ ä¼˜åŒ–: æ”¯ä»˜æµç¨‹å“åº”æ—¶é—´ (2s â†’ 800ms)
- ğŸ”§ è°ƒæ•´: æ”¯ä»˜é™é¢ (å•ç¬”5ä¸‡ â†’ 10ä¸‡)

**v3.2 (2023-11-01)**
- âœ¨ æ–°å¢: å¾®ä¿¡æ”¯ä»˜é›†æˆ
- ğŸ”„ é‡æ„: æ”¯ä»˜ç½‘å…³ç»Ÿä¸€æ¥å£
- ğŸ“± é€‚é…: ç§»åŠ¨ç«¯æ”¯ä»˜ä½“éªŒä¼˜åŒ–

ğŸ¯ **å½±å“è¯„ä¼°**:
- ç”¨æˆ·ä½“éªŒ: â­â­â­â­â­ (æ˜¾è‘—æå‡)
- æŠ€æœ¯å¤æ‚åº¦: â­â­â­â­ (ä¸­ç­‰)
- ä¸šåŠ¡ä»·å€¼: â­â­â­â­â­ (é«˜ä»·å€¼)`,
        Benefits: []string{
            "æ™ºèƒ½è¯†åˆ«å…³é”®å˜æ›´ç‚¹",
            "è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ‘˜è¦",
            "æä¾›å½±å“è¯„ä¼°",
            "æ”¯æŒå¤šç»´åº¦å¯¹æ¯”",
        },
        Metrics: DemoMetrics{
            TraditionalSearchTime: 25,
            AISearchTime:         45,
            AccuracyImprovement:  0.90,
            ProductivityGain:     0.88,
        },
    },
}
```

##### 2. **ROIè®¡ç®—å’Œä»·å€¼å±•ç¤º** ğŸ“Š
```go
type ROICalculator struct {
    // å›¢é˜ŸåŸºç¡€ä¿¡æ¯
    TeamSize          int     // å›¢é˜Ÿäººæ•°
    AverageSalary     float64 // å¹³å‡æœˆè–ª
    WorkDaysPerMonth  int     // æ¯æœˆå·¥ä½œæ—¥
    
    // å½“å‰æœç´¢æƒ…å†µ
    AvgSearchTime     float64 // å¹³å‡æœç´¢æ—¶é—´(åˆ†é’Ÿ)
    SearchFrequency   int     // æ¯æ—¥æœç´¢æ¬¡æ•°
    SearchAccuracy    float64 // å½“å‰æœç´¢å‡†ç¡®ç‡
    
    // AIåŠ©æ‰‹æ”¹å–„æ•ˆæœ
    TimeReduction     float64 // æ—¶é—´èŠ‚çœæ¯”ä¾‹
    AccuracyBoost     float64 // å‡†ç¡®ç‡æå‡
    AdditionalBenefits float64 // å…¶ä»–æ”¶ç›Šç³»æ•°
}

func (calc *ROICalculator) CalculateMonthlyROI() ROIReport {
    // è®¡ç®—å½“å‰æˆæœ¬
    dailySearchCost := float64(calc.TeamSize) * 
                      float64(calc.SearchFrequency) * 
                      calc.AvgSearchTime / 60 * // è½¬æ¢ä¸ºå°æ—¶
                      (calc.AverageSalary / float64(calc.WorkDaysPerMonth) / 8) // å°æ—¶å·¥èµ„
    
    monthlySearchCost := dailySearchCost * float64(calc.WorkDaysPerMonth)
    
    // è®¡ç®—èŠ‚çœæˆæœ¬
    timeSavingCost := monthlySearchCost * calc.TimeReduction
    accuracySavingCost := monthlySearchCost * (calc.AccuracyBoost / (1 - calc.SearchAccuracy))
    additionalSavingCost := monthlySearchCost * calc.AdditionalBenefits
    
    totalMonthlySaving := timeSavingCost + accuracySavingCost + additionalSavingCost
    
    return ROIReport{
        TeamSize:           calc.TeamSize,
        MonthlySearchCost:  monthlySearchCost,
        TimeSaving:         timeSavingCost,
        AccuracySaving:     accuracySavingCost,
        AdditionalSaving:   additionalSavingCost,
        TotalMonthlySaving: totalMonthlySaving,
        AnnualSaving:       totalMonthlySaving * 12,
        ROIRatio:           totalMonthlySaving / monthlySearchCost,
    }
}

type ROIReport struct {
    TeamSize           int
    MonthlySearchCost  float64
    TimeSaving         float64
    AccuracySaving     float64
    AdditionalSaving   float64
    TotalMonthlySaving float64
    AnnualSaving       float64
    ROIRatio           float64
}

func (report *ROIReport) GeneratePresentation() string {
    return fmt.Sprintf(`
ğŸ¯ **AIæ–‡æ¡£åŠ©æ‰‹ROIåˆ†ææŠ¥å‘Š**

ğŸ‘¥ **å›¢é˜Ÿè§„æ¨¡**: %däºº
ğŸ’° **å½“å‰æœˆåº¦æ–‡æ¡£æœç´¢æˆæœ¬**: Â¥%.0f

ğŸ“ˆ **AIåŠ©æ‰‹å¸¦æ¥çš„æœˆåº¦èŠ‚çœ**:
â±ï¸  æ—¶é—´æ•ˆç‡æå‡: Â¥%.0f  
ğŸ¯ å‡†ç¡®ç‡æå‡æ”¶ç›Š: Â¥%.0f
âœ¨ é™„åŠ ä»·å€¼æ”¶ç›Š: Â¥%.0f

ğŸ’ **æ€»è®¡æœˆåº¦æ”¶ç›Š**: Â¥%.0f
ğŸš€ **å¹´åº¦æ”¶ç›Šé¢„ä¼°**: Â¥%.0f  
ğŸ“Š **æŠ•èµ„å›æŠ¥ç‡**: %.1f%%

ğŸ’¡ **ç»“è®º**: æ¯æŠ•å…¥1å…ƒï¼Œé¢„æœŸå›æŠ¥%.1få…ƒ
`, 
        report.TeamSize,
        report.MonthlySearchCost,
        report.TimeSaving,
        report.AccuracySaving, 
        report.AdditionalSaving,
        report.TotalMonthlySaving,
        report.AnnualSaving,
        report.ROIRatio * 100,
        report.ROIRatio,
    )
}
```

#### ğŸ”§ **Phase 3: æŠ€æœ¯æ‰‹æ®µä¸ç­–ç•¥é…åˆ**

##### 1. **ç”¨æˆ·ä¸»åŠ¨æˆæƒæ¨¡å¼** ğŸ‘¥
```go
// ç”¨æˆ·æ–‡æ¡£åˆ†äº«ç³»ç»Ÿ
type DocumentShareService struct {
    db           *sql.DB
    feishuClient *feishu.Client
    permissions  map[string][]SharePermission
}

type DocumentShare struct {
    ID          string    `json:"id"`
    UserID      string    `json:"user_id"`
    UserName    string    `json:"user_name"`
    DocumentID  string    `json:"document_id"`
    DocumentTitle string  `json:"document_title"`
    ShareTime   time.Time `json:"share_time"`
    ExpireTime  time.Time `json:"expire_time"`
    Permission  SharePermission `json:"permission"`
    Status      ShareStatus     `json:"status"`
}

type SharePermission string
const (
    ReadOnlyPermission SharePermission = "read"      // ä»…è¯»å–
    AnalyzePermission                  = "analyze"   // å…è®¸AIåˆ†æ
    IndexPermission                    = "index"     // å…è®¸å»ºç«‹ç´¢å¼•
    FullPermission                     = "full"      // å®Œå…¨æƒé™
)

type ShareStatus string
const (
    ActiveShare   ShareStatus = "active"
    ExpiredShare             = "expired" 
    RevokedShare             = "revoked"
)

// ç”¨æˆ·åˆ†äº«æ–‡æ¡£ç»™AIåŠ©æ‰‹
func (dss *DocumentShareService) ShareDocument(request ShareRequest) (*DocumentShare, error) {
    // 1. éªŒè¯ç”¨æˆ·å¯¹æ–‡æ¡£çš„æƒé™
    hasPermission, err := dss.verifyUserDocumentPermission(request.UserID, request.DocumentID)
    if err != nil {
        return nil, fmt.Errorf("æƒé™éªŒè¯å¤±è´¥: %v", err)
    }
    if !hasPermission {
        return nil, fmt.Errorf("ç”¨æˆ·å¯¹æ–‡æ¡£æ— è¶³å¤Ÿæƒé™")
    }
    
    // 2. åˆ›å»ºåˆ†äº«è®°å½•
    share := &DocumentShare{
        ID:          generateShareID(),
        UserID:      request.UserID,
        DocumentID:  request.DocumentID,
        ShareTime:   time.Now(),
        ExpireTime:  time.Now().AddDate(0, 0, 30), // 30å¤©æœ‰æ•ˆæœŸ
        Permission:  request.Permission,
        Status:      ActiveShare,
    }
    
    // 3. ä¿å­˜åˆ°æ•°æ®åº“
    if err := dss.saveDocumentShare(share); err != nil {
        return nil, fmt.Errorf("ä¿å­˜åˆ†äº«è®°å½•å¤±è´¥: %v", err)
    }
    
    // 4. æ›´æ–°AIåŠ©æ‰‹è®¿é—®æƒé™
    if err := dss.updateAIPermission(share); err != nil {
        return nil, fmt.Errorf("æ›´æ–°AIæƒé™å¤±è´¥: %v", err)
    }
    
    // 5. å‘é€ç¡®è®¤é€šçŸ¥
    dss.sendShareConfirmation(share)
    
    log.Printf("âœ… ç”¨æˆ· %s åˆ†äº«æ–‡æ¡£ %s ç»™AIåŠ©æ‰‹", request.UserID, request.DocumentID)
    return share, nil
}

// æ‰¹é‡åˆ†äº«æ¥å£ - æ”¯æŒå›¢é˜Ÿleaderæ‰¹é‡æˆæƒ
func (dss *DocumentShareService) BatchShareDocuments(request BatchShareRequest) ([]DocumentShare, error) {
    var shares []DocumentShare
    var errors []error
    
    for _, docID := range request.DocumentIDs {
        shareReq := ShareRequest{
            UserID:     request.UserID,
            DocumentID: docID,
            Permission: request.Permission,
        }
        
        if share, err := dss.ShareDocument(shareReq); err != nil {
            errors = append(errors, err)
        } else {
            shares = append(shares, *share)
        }
    }
    
    if len(errors) > 0 {
        return shares, fmt.Errorf("éƒ¨åˆ†æ–‡æ¡£åˆ†äº«å¤±è´¥: %v", errors)
    }
    
    return shares, nil
}
```

##### 2. **æƒé™ç”³è¯·è‡ªåŠ¨åŒ–æµç¨‹** ğŸ¤–
```go
type PermissionRequestService struct {
    workflow     *WorkflowEngine
    notification *NotificationService  
    approval     *ApprovalService
}

type PermissionRequest struct {
    ID             string           `json:"id"`
    RequesterID    string           `json:"requester_id"`
    RequestType    PermissionType   `json:"request_type"`
    Scope          string           `json:"scope"`
    Justification  string           `json:"justification"`
    BusinessValue  string           `json:"business_value"`
    SecurityPlan   string           `json:"security_plan"`
    Timeline       string           `json:"timeline"`
    Status         RequestStatus    `json:"status"`
    ApprovalChain  []ApprovalStep   `json:"approval_chain"`
    SubmitTime     time.Time        `json:"submit_time"`
    Evidence       []Evidence       `json:"evidence"`
}

type Evidence struct {
    Type        string    `json:"type"`        // demo, document, metrics
    Title       string    `json:"title"`
    Description string    `json:"description"`
    URL         string    `json:"url"`
    CreatedAt   time.Time `json:"created_at"`
}

func (prs *PermissionRequestService) SubmitPermissionRequest(req PermissionRequest) error {
    // 1. è‡ªåŠ¨ç”Ÿæˆç”³è¯·ID
    req.ID = generateRequestID()
    req.SubmitTime = time.Now()
    req.Status = PendingReview
    
    // 2. æ·»åŠ ç³»ç»Ÿæ”¶é›†çš„è¯æ®
    evidence, err := prs.collectAutomaticEvidence(req)
    if err != nil {
        log.Printf("âš ï¸  è‡ªåŠ¨è¯æ®æ”¶é›†å¤±è´¥: %v", err)
    } else {
        req.Evidence = append(req.Evidence, evidence...)
    }
    
    // 3. ç¡®å®šå®¡æ‰¹é“¾è·¯
    req.ApprovalChain = prs.determineApprovalChain(req)
    
    // 4. ä¿å­˜ç”³è¯·
    if err := prs.saveRequest(req); err != nil {
        return fmt.Errorf("ä¿å­˜ç”³è¯·å¤±è´¥: %v", err)
    }
    
    // 5. å¯åŠ¨å·¥ä½œæµ
    if err := prs.workflow.StartPermissionApproval(req); err != nil {
        return fmt.Errorf("å¯åŠ¨å®¡æ‰¹æµç¨‹å¤±è´¥: %v", err)
    }
    
    // 6. å‘é€é€šçŸ¥
    prs.notification.SendRequestSubmitted(req)
    
    log.Printf("ğŸš€ æƒé™ç”³è¯·å·²æäº¤: %s", req.ID)
    return nil
}

// è‡ªåŠ¨æ”¶é›†æ”¯æŒè¯æ®
func (prs *PermissionRequestService) collectAutomaticEvidence(req PermissionRequest) ([]Evidence, error) {
    var evidence []Evidence
    
    // æ”¶é›†æŠ€æœ¯æ¼”ç¤ºè§†é¢‘
    if demoURL, err := prs.generateDemoVideo(req); err == nil {
        evidence = append(evidence, Evidence{
            Type: "demo",
            Title: "AIåŠ©æ‰‹åŠŸèƒ½æ¼”ç¤º",
            Description: "å±•ç¤ºæ ¸å¿ƒåŠŸèƒ½å’Œç”¨æˆ·äº¤äº’ä½“éªŒ",
            URL: demoURL,
            CreatedAt: time.Now(),
        })
    }
    
    // ç”ŸæˆROIè®¡ç®—æŠ¥å‘Š
    if roiReport, err := prs.generateROIReport(req); err == nil {
        evidence = append(evidence, Evidence{
            Type: "metrics",
            Title: "æŠ•èµ„å›æŠ¥ç‡åˆ†æ",
            Description: roiReport.GeneratePresentation(),
            CreatedAt: time.Now(),
        })
    }
    
    // æ”¶é›†ç”¨æˆ·åé¦ˆ
    if feedback, err := prs.collectUserFeedback(req); err == nil {
        evidence = append(evidence, Evidence{
            Type: "document",
            Title: "ç”¨æˆ·åé¦ˆæŠ¥å‘Š", 
            Description: feedback,
            CreatedAt: time.Now(),
        })
    }
    
    return evidence, nil
}
```

#### ğŸ¯ **å®æ–½å»ºè®®ä¸æœ€ä½³å®è·µ**

##### 1. **ç«‹å³è¡ŒåŠ¨æ¸…å•** âœ…
```go
type ImmediateActionPlan struct {
    Week1Actions []Action
    Week2Actions []Action
    Week3Actions []Action
    Week4Actions []Action
}

var QuickStartPlan = ImmediateActionPlan{
    Week1Actions: []Action{
        {
            Task: "æ­å»ºå¼€å‘ç¯å¢ƒ",
            Details: []string{
                "åˆå§‹åŒ–Einoé¡¹ç›®ç»“æ„",
                "é…ç½®Milvuså‘é‡æ•°æ®åº“",
                "åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå™¨",
                "å®ç°åŸºç¡€é—®ç­”åŠŸèƒ½",
            },
            ExpectedOutcome: "MVPç³»ç»Ÿå¯ç”¨",
        },
        {
            Task: "åˆ›å»ºæµ‹è¯•æ–‡æ¡£é›†",
            Details: []string{
                "åœ¨é£ä¹¦åˆ›å»ºä¸ªäººæµ‹è¯•ç©ºé—´",
                "ä¸Šä¼ 20ä¸ªä¸åŒç±»å‹çš„æ¨¡æ‹Ÿæ–‡æ¡£",
                "å»ºç«‹æ–‡æ¡£åˆ†ç±»å’Œæ ‡ç­¾ä½“ç³»",
                "æµ‹è¯•æ–‡æ¡£åŒæ­¥åŠŸèƒ½",
            },
            ExpectedOutcome: "æµ‹è¯•æ•°æ®é›†å°±ç»ª",
        },
    },
    
    Week2Actions: []Action{
        {
            Task: "å®Œå–„æ¼”ç¤ºæ–¹æ¡ˆ", 
            Details: []string{
                "è®¾è®¡3ä¸ªæ ¸å¿ƒä½¿ç”¨åœºæ™¯",
                "å½•åˆ¶åŠŸèƒ½æ¼”ç¤ºè§†é¢‘",
                "å‡†å¤‡ROIè®¡ç®—æ•°æ®",
                "åˆ¶ä½œæƒé™ç”³è¯·PPT",
            },
            ExpectedOutcome: "å®Œæ•´æ¼”ç¤ºææ–™",
        },
        {
            Task: "å¯åŠ¨å›¢é˜Ÿè¯•ç‚¹",
            Details: []string{
                "ä¸ç›´å±é¢†å¯¼æ²Ÿé€š",
                "é‚€è¯·2-3ä¸ªåŒäº‹å‚ä¸æµ‹è¯•",
                "æ”¶é›†ä½¿ç”¨åé¦ˆ",
                "ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ",
            },
            ExpectedOutcome: "è·å¾—å›¢é˜Ÿæ”¯æŒ",
        },
    },
    
    Week3Actions: []Action{
        {
            Task: "æ‰©å¤§è¯•ç‚¹èŒƒå›´",
            Details: []string{
                "ç”³è¯·é¡¹ç›®çº§æ–‡æ¡£æƒé™",
                "æ‰©å±•åˆ°20-30ä¸ªæ–‡æ¡£",
                "è¿›è¡Œæ€§èƒ½å‹åŠ›æµ‹è¯•",
                "æ”¶é›†é‡åŒ–æ•ˆæœæ•°æ®",
            },
            ExpectedOutcome: "éªŒè¯è§„æ¨¡åŒ–æ•ˆæœ",
        },
    },
    
    Week4Actions: []Action{
        {
            Task: "æ­£å¼æƒé™ç”³è¯·",
            Details: []string{
                "æ•´ç†å®Œæ•´ç”³è¯·ææ–™",
                "æäº¤æ­£å¼ç”³è¯·æµç¨‹",
                "è¿›è¡Œå®‰å…¨åˆè§„è¯„å®¡",
                "å‡†å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²",
            },
            ExpectedOutcome: "è·å¾—æ­£å¼æˆæƒ",
        },
    },
}
```

##### 2. **æƒé™ç”³è¯·æ¨¡æ¿** ğŸ“
```go
const PermissionRequestTemplate = `
ğŸ“‹ **AIæ–‡æ¡£åŠ©æ‰‹æƒé™ç”³è¯·ä¹¦**

## 1. é¡¹ç›®èƒŒæ™¯
**ç—›ç‚¹åˆ†æ**: 
- å›¢é˜Ÿæ–‡æ¡£æŸ¥æ‰¾æ•ˆç‡ä½ä¸‹ï¼Œå¹³å‡æ¯æ¬¡æœç´¢è€—æ—¶10-15åˆ†é’Ÿ
- å†å²éœ€æ±‚è¿½æº¯å›°éš¾ï¼Œå½±å“äº§å“å†³ç­–è´¨é‡
- æ–‡æ¡£åˆ†æ•£å­˜å‚¨ï¼ŒçŸ¥è¯†å¤ç”¨ç‡ä½

**è§£å†³æ–¹æ¡ˆ**: 
åŸºäºEinoæ¡†æ¶å¼€å‘æ™ºèƒ½æ–‡æ¡£åŠ©æ‰‹ï¼Œæä¾›è‡ªç„¶è¯­è¨€é—®ç­”èƒ½åŠ›

## 2. ç”³è¯·æƒé™èŒƒå›´
**å½“å‰ç”³è¯·**: {{.Scope}}
**é¢„æœŸæ–‡æ¡£æ•°é‡**: {{.DocumentCount}}
**æ¶‰åŠéƒ¨é—¨**: {{.Departments}}

## 3. æŠ€æœ¯æ¶æ„
**æ•°æ®å¤„ç†**: æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ ç¬¬ä¸‰æ–¹
**å­˜å‚¨æ–¹æ¡ˆ**: ä¼ä¸šå†…ç½‘éƒ¨ç½²ï¼ŒåŠ å¯†å­˜å‚¨
**è®¿é—®æ§åˆ¶**: åŸºäºé£ä¹¦æƒé™ä½“ç³»ï¼Œç”¨æˆ·æˆæƒæœºåˆ¶

## 4. å®‰å…¨ä¿éšœæªæ–½
âœ… æ•°æ®åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
âœ… è®¿é—®æ—¥å¿—å®Œæ•´è®°å½•
âœ… ç”¨æˆ·æˆæƒæœºåˆ¶
âœ… å®šæœŸå®‰å…¨å®¡è®¡
âœ… æ•°æ®ä¿ç•™æœŸé™æ§åˆ¶

## 5. é¢„æœŸæ”¶ç›Š
**æ•ˆç‡æå‡**: æŸ¥æ‰¾æ—¶é—´ä»10åˆ†é’Ÿé™è‡³30ç§’
**æœˆåº¦èŠ‚çœæˆæœ¬**: {{.MonthlySaving}} å…ƒ
**å¹´åº¦ROI**: {{.AnnualROI}}%

## 6. é£é™©æ§åˆ¶
**æŠ€æœ¯é£é™©**: å·²å®ŒæˆMVPéªŒè¯ï¼ŒæŠ€æœ¯æ–¹æ¡ˆæˆç†Ÿ
**å®‰å…¨é£é™©**: ä¸¥æ ¼éµå¾ªæ•°æ®å®‰å…¨è§„èŒƒï¼Œæ”¯æŒæƒé™æ’¤é”€
**ä¸šåŠ¡é£é™©**: æ¸è¿›å¼æ¨å¹¿ï¼Œæ”¯æŒéšæ—¶å›é€€

## 7. å®æ–½è®¡åˆ’
- Phase 1: å°èŒƒå›´è¯•ç‚¹ (2å‘¨)
- Phase 2: å›¢é˜Ÿçº§æ‰©å±• (4å‘¨) 
- Phase 3: é¡¹ç›®çº§æ¨å¹¿ (6å‘¨)
- Phase 4: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² (8å‘¨)

## 8. è”ç³»æ–¹å¼
**é¡¹ç›®è´Ÿè´£äºº**: {{.ProjectOwner}}
**æŠ€æœ¯è´Ÿè´£äºº**: {{.TechOwner}}  
**ç”³è¯·æ—¥æœŸ**: {{.RequestDate}}
`
```

##### 3. **æˆåŠŸæ¡ˆä¾‹åˆ†äº«æ¨¡æ¿** ğŸ†
```go
type SuccessCase struct {
    CompanyName    string
    Industry       string
    TeamSize       int
    Challenge      string
    Solution       string
    Results        []string
    Metrics        map[string]interface{}
    Testimonial    string
}

var SuccessStoryTemplate = `
ğŸ¯ **{{.CompanyName}}AIæ–‡æ¡£åŠ©æ‰‹æˆåŠŸæ¡ˆä¾‹**

ğŸ¢ **å…¬å¸ä¿¡æ¯**
- è¡Œä¸š: {{.Industry}}  
- å›¢é˜Ÿè§„æ¨¡: {{.TeamSize}}äºº
- æŒ‘æˆ˜: {{.Challenge}}

ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**
{{.Solution}}

ğŸ“Š **å®æ–½æ•ˆæœ**
{{range .Results}}
âœ… {{.}}
{{end}}

ğŸ“ˆ **å…³é”®æŒ‡æ ‡**
{{range $key, $value := .Metrics}}
- {{$key}}: {{$value}}
{{end}}

ğŸ’¬ **ç”¨æˆ·åé¦ˆ**
"{{.Testimonial}}"
`
```

#### ğŸ” **å®‰å…¨åˆè§„è¦æ±‚**

##### å®æ–½å¿…è¦çš„å®‰å…¨æªæ–½
```go
type SecurityCompliance struct {
    DataEncryption    bool
    AccessLogging     bool  
    UserConsent       bool
    AuditTrail        bool
    DataRetention     int // å¤©æ•°
    BackupStrategy    string
    IncidentResponse  string
}

func ImplementSecurityMeasures() *SecurityCompliance {
    return &SecurityCompliance{
        DataEncryption:   true,  // AES-256åŠ å¯†
        AccessLogging:    true,  // å®Œæ•´è®¿é—®æ—¥å¿—
        UserConsent:      true,  // ç”¨æˆ·ä¸»åŠ¨æˆæƒ
        AuditTrail:       true,  // å®¡è®¡è¿½è¸ª
        DataRetention:    30,    // 30å¤©æ•°æ®ä¿ç•™
        BackupStrategy:   "æ¯æ—¥å¢é‡å¤‡ä»½ + æ¯å‘¨å…¨é‡å¤‡ä»½",
        IncidentResponse: "24å°æ—¶å“åº”ï¼Œç«‹å³é€šçŸ¥ç›¸å…³æ–¹",
    }
}
```

---

## ğŸ› ï¸ å®æ–½æ–¹æ¡ˆ

### Phase 1: æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆ4å‘¨ï¼‰

**Week 1-2: åŸºç¡€æ¶æ„æ­å»º**
- [x] Einoç¯å¢ƒé…ç½®
- [x] Milvuså‘é‡æ•°æ®åº“éƒ¨ç½²
- [x] æ–‡æ¡£å¤„ç†æµæ°´çº¿å¼€å‘
- [x] åŸºç¡€Webç•Œé¢

**Week 3-4: æ™ºèƒ½æ£€ç´¢åŠŸèƒ½**
- [x] RAGæ£€ç´¢é“¾å®ç°
- [x] å¤šæ¨¡æ€æ–‡æ¡£è§£æ
- [x] åŸºç¡€é—®ç­”åŠŸèƒ½
- [x] æ£€ç´¢ç»“æœä¼˜åŒ–

### Phase 2: é«˜çº§åŠŸèƒ½å¼€å‘ï¼ˆ3å‘¨ï¼‰

**Week 5-6: å®æ—¶æ›´æ–°æœºåˆ¶**
- [x] æ–‡ä»¶ç›‘æ§ç³»ç»Ÿ
- [x] å¢é‡æ›´æ–°é€»è¾‘
- [x] ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½

**Week 7: é£ä¹¦é›†æˆ**
- [x] é£ä¹¦æœºå™¨äººå¼€å‘
- [x] æ¶ˆæ¯æ¨é€åŠŸèƒ½
- [x] ç”¨æˆ·æƒé™ç®¡ç†

### Phase 3: ä¼˜åŒ–ä¸éƒ¨ç½²ï¼ˆ2å‘¨ï¼‰

**Week 8: ç³»ç»Ÿä¼˜åŒ–**
- [x] æ€§èƒ½è°ƒä¼˜
- [x] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [x] é”™è¯¯å¤„ç†å®Œå–„

**Week 9: ä¸Šçº¿éƒ¨ç½²**
- [x] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [x] ç”¨æˆ·åŸ¹è®­
- [x] è¿ç»´ç›‘æ§

---

## ğŸ’» æŠ€æœ¯å®ç°è¯¦è§£

### å®Œæ•´åº”ç”¨ç¤ºä¾‹

```go
package main

import (
    "context"
    "log"
    "os"
    "os/signal"
    "syscall"
    
    "github.com/gin-gonic/gin"
    "your-project/pkg/feishu"
    "your-project/pkg/pipeline"
    "your-project/pkg/retrieval"
    "your-project/pkg/webhook"
)

func main() {
    // è¯»å–é…ç½®
    config := loadConfig()
    
    // åˆå§‹åŒ–é£ä¹¦å®¢æˆ·ç«¯
    feishuClient := feishu.NewFeishuDocClient(
        config.Feishu.AppID,
        config.Feishu.AppSecret,
    )
    
    // åˆ›å»ºæ–‡æ¡£å¤„ç†æµæ°´çº¿
    docPipeline := pipeline.NewFeishuDocumentPipeline()
    
    // åˆ›å»ºæ–‡æ¡£åŒæ­¥å™¨
    syncer := feishu.NewFeishuDocumentSyncer(feishuClient, docPipeline)
    
    // åˆ›å»ºé—®ç­”ç³»ç»Ÿ
    qaSystem := retrieval.NewDocumentQASystem()
    
    // åˆ›å»ºé€šçŸ¥å™¨
    notifier := feishu.NewFeishuNotifier(config.Feishu.Bot.WebhookURL)
    
    // åˆ›å»ºWebhookç›‘å¬å™¨
    webhookListener := webhook.NewFeishuWebhookListener(syncer, notifier)
    
    // è®¾ç½®APIè·¯ç”±
    router := gin.Default()
    setupAPIRoutes(router, qaSystem)
    
    // å¯åŠ¨æœåŠ¡
    go func() {
        log.Println("å¯åŠ¨APIæœåŠ¡å™¨ :8080")
        if err := router.Run(":8080"); err != nil {
            log.Fatalf("APIæœåŠ¡å™¨å¯åŠ¨å¤±è´¥: %v", err)
        }
    }()
    
    go func() {
        log.Println("å¯åŠ¨Webhookç›‘å¬å™¨ :8081")
        if err := webhookListener.Start(":8081"); err != nil {
            log.Fatalf("Webhookç›‘å¬å™¨å¯åŠ¨å¤±è´¥: %v", err)
        }
    }()
    
    // é¦–æ¬¡å…¨é‡åŒæ­¥
    log.Println("å¼€å§‹å…¨é‡åŒæ­¥æ–‡æ¡£...")
    if err := syncer.SyncAllDocuments(context.Background()); err != nil {
        log.Printf("å…¨é‡åŒæ­¥å¤±è´¥: %v", err)
    } else {
        log.Println("å…¨é‡åŒæ­¥å®Œæˆ")
    }
    
    // è®¾ç½®Webhook
    if err := feishuClient.SetupWebhook(context.Background(), "http://your-domain.com:8081/webhook/feishu"); err != nil {
        log.Printf("è®¾ç½®Webhookå¤±è´¥: %v", err)
    }
    
    // ç­‰å¾…é€€å‡ºä¿¡å·
    quit := make(chan os.Signal, 1)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    <-quit
    
    log.Println("æœåŠ¡å™¨æ­£åœ¨å…³é—­...")
}

func setupAPIRoutes(router *gin.Engine, qaSystem *retrieval.DocumentQASystem) {
    api := router.Group("/api/v1")
    
    // æ–‡æ¡£é—®ç­”æ¥å£
    api.POST("/ask", func(c *gin.Context) {
        var request struct {
            Question string `json:"question" binding:"required"`
        }
        
        if err := c.ShouldBindJSON(&request); err != nil {
            c.JSON(400, gin.H{"error": err.Error()})
            return
        }
        
        answer, err := qaSystem.Ask(c.Request.Context(), request.Question)
        if err != nil {
            c.JSON(500, gin.H{"error": err.Error()})
            return
        }
        
        c.JSON(200, gin.H{
            "answer": answer,
            "timestamp": time.Now(),
        })
    })
    
    // å¥åº·æ£€æŸ¥æ¥å£
    api.GET("/health", func(c *gin.Context) {
        c.JSON(200, gin.H{"status": "ok"})
    })
}

type Config struct {
    Feishu struct {
        AppID     string `yaml:"app_id"`
        AppSecret string `yaml:"app_secret"`
        Bot       struct {
            WebhookURL string `yaml:"webhook_url"`
        } `yaml:"bot"`
    } `yaml:"feishu"`
}

func loadConfig() *Config {
    // å®ç°é…ç½®æ–‡ä»¶åŠ è½½é€»è¾‘
    return &Config{}
}
```

### é¡¹ç›®ç»“æ„

```
feishu-doc-ai/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ feishu/                     # é£ä¹¦APIé›†æˆ
â”‚   â”‚   â”œâ”€â”€ client.go              # é£ä¹¦APIå®¢æˆ·ç«¯  
â”‚   â”‚   â”œâ”€â”€ syncer.go              # æ–‡æ¡£åŒæ­¥å™¨
â”‚   â”‚   â””â”€â”€ notifier.go            # é£ä¹¦é€šçŸ¥å™¨
â”‚   â”œâ”€â”€ pipeline/                   # æ–‡æ¡£å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ processor.go           # æ–‡æ¡£å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ parser.go              # å†…å®¹è§£æå™¨
â”‚   â”œâ”€â”€ retrieval/                  # æ£€ç´¢å’Œé—®ç­”
â”‚   â”‚   â”œâ”€â”€ qa.go                  # é—®ç­”ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ analyzer.go            # æŸ¥è¯¢åˆ†æå™¨
â”‚   â”œâ”€â”€ webhook/                    # Webhookå¤„ç†
â”‚   â”‚   â”œâ”€â”€ listener.go            # äº‹ä»¶ç›‘å¬å™¨
â”‚   â”‚   â””â”€â”€ handler.go             # äº‹ä»¶å¤„ç†å™¨
â”‚   â””â”€â”€ config/                     # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ config.go              # é…ç½®ç»“æ„ä½“
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ config.yaml                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile                  # Dockeræ„å»ºæ–‡ä»¶
â”‚   â””â”€â”€ docker-compose.yml         # å®¹å™¨ç¼–æ’
â”œâ”€â”€ docs/                           # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ go.mod                          # Goæ¨¡å—æ–‡ä»¶
â””â”€â”€ go.sum                          # ä¾èµ–ç‰ˆæœ¬é”å®š
```

### Goä¾èµ–ç®¡ç†

```go
// go.mod
module feishu-doc-ai

go 1.21

require (
    github.com/cloudwego/eino v0.0.10
    github.com/gin-gonic/gin v1.9.1
    github.com/go-redis/redis/v8 v8.11.5
    github.com/milvus-io/milvus-sdk-go/v2 v2.3.1
    github.com/spf13/viper v1.16.0
    github.com/stretchr/testify v1.8.4
    gopkg.in/yaml.v3 v3.0.1
)
```

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

```yaml
# configs/config.yaml
app:
  name: "é£ä¹¦æ–‡æ¡£AIåŠ©æ‰‹"
  version: "1.0.0"
  host: "0.0.0.0"
  port: 8080
  webhook_port: 8081

# é£ä¹¦é…ç½® (å·²åœ¨å‰é¢æä¾›)
feishu:
  app_id: "${FEISHU_APP_ID}"
  app_secret: "${FEISHU_APP_SECRET}"
  # ... (å…¶ä»–é…ç½®)

# Einoæ¡†æ¶é…ç½®
eino:
  models:
    embedding:
      provider: "openai"
      model: "text-embedding-ada-002"
    chat:
      provider: "openai" 
      model: "gpt-4"
      
  # Milvuså‘é‡æ•°æ®åº“
  milvus:
    host: "localhost"
    port: 19530
    collection: "feishu_docs"
    dimension: 1536
    
  # æ–‡æ¡£å¤„ç†é…ç½®
  document:
    chunk_size: 512
    chunk_overlap: 50
    batch_size: 100
```

---

## ğŸ—ï¸ è¯¦ç»†ç³»ç»Ÿè®¾è®¡

### 26. ç³»ç»Ÿæ¶æ„å›¾

#### æ•´ä½“æ¶æ„æ¦‚è§ˆ
```
                    ğŸŒ Internet
                         â”‚
                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                    â”‚  Nginx  â”‚ (è´Ÿè½½å‡è¡¡ + SSL)
                    â”‚ Gateway â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚API æœåŠ¡1â”‚     â”‚API æœåŠ¡2â”‚     â”‚API æœåŠ¡3â”‚
   â”‚:8080    â”‚     â”‚:8080    â”‚     â”‚:8080    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                         â”‚
       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
       â”‚Webhook  â”‚              â”‚å®šæ—¶ä»»åŠ¡  â”‚
       â”‚ç›‘å¬å™¨   â”‚              â”‚è°ƒåº¦å™¨   â”‚
       â”‚:8081    â”‚              â”‚Cron     â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             Eino å¤„ç†å¼•æ“               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Document        â”‚ Embedding           â”‚
    â”‚ Processor       â”‚ Generator           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Content         â”‚ Vector              â”‚
    â”‚ Splitter        â”‚ Indexer             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Milvus  â”‚     â”‚ MySQL   â”‚     â”‚ Redis   â”‚
   â”‚å‘é‡æ•°æ®åº“â”‚     â”‚å…ƒæ•°æ®åº“  â”‚     â”‚ç¼“å­˜å±‚   â”‚
   â”‚:19530   â”‚     â”‚:3306    â”‚     â”‚:6379    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                     â”‚
               â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
               â”‚é£ä¹¦API   â”‚                          â”‚OpenAI   â”‚
               â”‚é›†æˆå±‚    â”‚                          â”‚API      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æµæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP/HTTPS    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  APIç½‘å…³    â”‚
â”‚ React/Vue   â”‚                  â”‚   Nginx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚  ä¸šåŠ¡æœåŠ¡å±‚  â”‚
                                â”‚  Go Server  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ•°æ®å¤„ç†å±‚  â”‚    â”‚   å­˜å‚¨å±‚    â”‚    â”‚  å¤–éƒ¨æœåŠ¡å±‚  â”‚
            â”‚ Eino Engine â”‚    â”‚MySQL/Milvusâ”‚    â”‚é£ä¹¦/OpenAI  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 27. æ•°æ®åº“Schemaè®¾è®¡

#### æ•°æ®è·å–ç­–ç•¥ä¸åŒæ­¥æµç¨‹

**ğŸ“Š æ•°æ®æ¥æºæ˜ å°„è¡¨ï¼š**

| è¡¨å | ä¸»è¦æ•°æ®æ¥æº | è·å–æ–¹å¼ | åŒæ­¥é¢‘ç‡ | ä¾èµ–å…³ç³» |
|-----|-------------|----------|---------|---------|
| documents | é£ä¹¦æ–‡æ¡£API | å…¨é‡+å¢é‡åŒæ­¥ | å®æ—¶+å®šæ—¶ | ç‹¬ç«‹è¡¨ |
| document_chunks | æ–‡æ¡£å†…å®¹è§£æ | æ–‡æ¡£å¤„ç†åç”Ÿæˆ | è·Ÿéšæ–‡æ¡£æ›´æ–° | ä¾èµ–documents |
| users | é£ä¹¦ç”¨æˆ·API | OAuth+ä¸»åŠ¨åŒæ­¥ | ç™»å½•æ—¶+å®šæ—¶ | ç‹¬ç«‹è¡¨ |
| document_permissions | é£ä¹¦æƒé™API | æ–‡æ¡£æƒé™æŸ¥è¯¢ | è·Ÿéšæ–‡æ¡£åŒæ­¥ | ä¾èµ–documents+users |

#### è¯¦ç»†æ•°æ®è·å–å®ç°

**ğŸ”„ å®Œæ•´åŒæ­¥æµç¨‹å›¾ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é£ä¹¦API    â”‚    â”‚  æ•°æ®å¤„ç†    â”‚    â”‚  æœ¬åœ°å­˜å‚¨    â”‚
â”‚  æ•°æ®æº     â”‚    â”‚  è½¬æ¢å±‚     â”‚    â”‚  MySQL      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.æ–‡æ¡£åˆ—è¡¨   â”‚â”€â”€â”€â–¶â”‚ è§£æ+åˆ†å—    â”‚â”€â”€â”€â–¶â”‚ documents   â”‚
â”‚ 2.æ–‡æ¡£å†…å®¹   â”‚    â”‚ å‘é‡åŒ–      â”‚    â”‚ chunks      â”‚
â”‚ 3.ç”¨æˆ·ä¿¡æ¯   â”‚    â”‚ æƒé™æ˜ å°„    â”‚    â”‚ users       â”‚
â”‚ 4.æƒé™ä¿¡æ¯   â”‚    â”‚ å…³ç³»æ„å»º    â”‚    â”‚ permissions â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MySQL å…ƒæ•°æ®å­˜å‚¨
```sql
-- æ–‡æ¡£ä¿¡æ¯è¡¨
CREATE TABLE documents (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    doc_token VARCHAR(64) NOT NULL UNIQUE COMMENT 'é£ä¹¦æ–‡æ¡£token',
    doc_type ENUM('doc', 'sheet', 'bitable', 'wiki') NOT NULL COMMENT 'æ–‡æ¡£ç±»å‹',
    title VARCHAR(512) NOT NULL COMMENT 'æ–‡æ¡£æ ‡é¢˜',
    url VARCHAR(1024) NOT NULL COMMENT 'æ–‡æ¡£é“¾æ¥',
    owner_id VARCHAR(64) NOT NULL COMMENT 'æ–‡æ¡£æ‰€æœ‰è€…ID',
    owner_name VARCHAR(128) NOT NULL COMMENT 'æ–‡æ¡£æ‰€æœ‰è€…å§“å',
    folder_token VARCHAR(64) COMMENT 'æ‰€å±æ–‡ä»¶å¤¹token',
    content_hash VARCHAR(64) COMMENT 'å†…å®¹hashï¼Œç”¨äºæ£€æµ‹å˜æ›´',
    word_count INT DEFAULT 0 COMMENT 'æ–‡æ¡£å­—æ•°',
    chunk_count INT DEFAULT 0 COMMENT 'åˆ†å—æ•°é‡',
    status ENUM('active', 'deleted', 'processing', 'failed') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    synced_at TIMESTAMP NULL COMMENT 'æœ€ååŒæ­¥æ—¶é—´',
    
    INDEX idx_doc_token (doc_token),
    INDEX idx_doc_type (doc_type),
    INDEX idx_owner_id (owner_id),
    INDEX idx_updated_at (updated_at),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ–‡æ¡£åŸºæœ¬ä¿¡æ¯è¡¨';

-- æ–‡æ¡£å†…å®¹å—è¡¨
CREATE TABLE document_chunks (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    document_id BIGINT NOT NULL COMMENT 'æ–‡æ¡£ID',
    chunk_index INT NOT NULL COMMENT 'å—åºå·',
    content TEXT NOT NULL COMMENT 'æ–‡æœ¬å†…å®¹',
    content_type ENUM('text', 'table', 'image', 'code') DEFAULT 'text',
    char_count INT NOT NULL DEFAULT 0,
    vector_id VARCHAR(64) COMMENT 'Milvusä¸­çš„å‘é‡ID',
    metadata JSON COMMENT 'é¢å¤–å…ƒæ•°æ®',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,
    INDEX idx_document_id (document_id),
    INDEX idx_vector_id (vector_id),
    UNIQUE KEY uk_doc_chunk (document_id, chunk_index)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ–‡æ¡£å†…å®¹åˆ†å—è¡¨';

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    feishu_user_id VARCHAR(64) NOT NULL UNIQUE COMMENT 'é£ä¹¦ç”¨æˆ·ID',
    name VARCHAR(128) NOT NULL COMMENT 'ç”¨æˆ·å§“å',
    avatar_url VARCHAR(512) COMMENT 'å¤´åƒé“¾æ¥',
    email VARCHAR(256) COMMENT 'é‚®ç®±',
    department VARCHAR(256) COMMENT 'éƒ¨é—¨',
    role ENUM('admin', 'user', 'guest') DEFAULT 'user',
    status ENUM('active', 'inactive') DEFAULT 'active',
    last_login_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_feishu_user_id (feishu_user_id),
    INDEX idx_email (email),
    INDEX idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ä¿¡æ¯è¡¨';

-- æ–‡æ¡£æƒé™è¡¨
CREATE TABLE document_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    document_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    permission ENUM('owner', 'editor', 'viewer') NOT NULL,
    granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    granted_by BIGINT COMMENT 'æˆæƒè€…ID',
    
    FOREIGN KEY (document_id) REFERENCES documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_doc_user (document_id, user_id),
    INDEX idx_user_id (user_id),
    INDEX idx_permission (permission)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ–‡æ¡£æƒé™è¡¨';

-- é—®ç­”è®°å½•è¡¨
CREATE TABLE qa_sessions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(64) NOT NULL COMMENT 'ä¼šè¯ID',
    user_id BIGINT NOT NULL,
    question TEXT NOT NULL,
    answer TEXT,
    context_docs JSON COMMENT 'å‚è€ƒçš„æ–‡æ¡£åˆ—è¡¨',
    satisfaction_score TINYINT COMMENT 'æ»¡æ„åº¦è¯„åˆ† 1-5',
    response_time_ms INT COMMENT 'å“åº”æ—¶é—´(æ¯«ç§’)',
    model_used VARCHAR(64) COMMENT 'ä½¿ç”¨çš„AIæ¨¡å‹',
    tokens_used INT COMMENT 'æ¶ˆè€—çš„tokenæ•°',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é—®ç­”è®°å½•è¡¨';

-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_configs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    config_key VARCHAR(128) NOT NULL UNIQUE,
    config_value TEXT NOT NULL,
    config_type ENUM('string', 'int', 'float', 'bool', 'json') DEFAULT 'string',
    description VARCHAR(512),
    updated_by BIGINT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_config_key (config_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç³»ç»Ÿé…ç½®è¡¨';

-- åŒæ­¥æ—¥å¿—è¡¨
CREATE TABLE sync_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    sync_type ENUM('full', 'incremental', 'single') NOT NULL,
    document_id BIGINT COMMENT 'å•æ–‡æ¡£åŒæ­¥æ—¶çš„æ–‡æ¡£ID',
    status ENUM('running', 'success', 'failed') NOT NULL,
    total_docs INT DEFAULT 0,
    processed_docs INT DEFAULT 0,
    failed_docs INT DEFAULT 0,
    error_message TEXT,
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    
    INDEX idx_sync_type (sync_type),
    INDEX idx_status (status),
    INDEX idx_started_at (started_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒæ­¥æ—¥å¿—è¡¨';
```

#### Milvus å‘é‡æ•°æ®åº“Schema
```go
// Milvus Collection Schema
type DocumentVector struct {
    ID          int64     `milvus:"id,primary_key,auto_id"`           // ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆ
    DocumentID  int64     `milvus:"document_id"`                      // æ–‡æ¡£IDï¼Œå¯¹åº”MySQL
    ChunkIndex  int32     `milvus:"chunk_index"`                      // å—ç´¢å¼•
    Vector      []float32 `milvus:"vector,dim:1536"`                 // 1536ç»´å‘é‡
    ContentHash string    `milvus:"content_hash,varchar:64"`         // å†…å®¹hash
    DocType     string    `milvus:"doc_type,varchar:16"`             // æ–‡æ¡£ç±»å‹
    UpdateTime  int64     `milvus:"update_time"`                     // æ›´æ–°æ—¶é—´æˆ³
}

// åˆ›å»ºCollectionçš„å‚æ•°
CollectionSchema: {
    Name: "feishu_docs",
    Fields: [
        {Name: "id", DataType: Int64, PrimaryKey: true, AutoID: true},
        {Name: "document_id", DataType: Int64},
        {Name: "chunk_index", DataType: Int32},
        {Name: "vector", DataType: FloatVector, Dim: 1536},
        {Name: "content_hash", DataType: VarChar, MaxLength: 64},
        {Name: "doc_type", DataType: VarChar, MaxLength: 16},
        {Name: "update_time", DataType: Int64},
    ],
    Indexes: [
        {FieldName: "vector", IndexType: "IVF_FLAT", MetricType: "L2", Params: {"nlist": 1024}},
        {FieldName: "document_id", IndexType: "STL_SORT"},
        {FieldName: "doc_type", IndexType: "STL_SORT"},
    ]
}
```

#### æ ¸å¿ƒè¡¨æ•°æ®è·å–è¯¦ç»†å®ç°

**1ï¸âƒ£ Documentsè¡¨ - æ–‡æ¡£ä¿¡æ¯è·å–**

```go
// é£ä¹¦APIè°ƒç”¨è·å–æ–‡æ¡£åˆ—è¡¨
func (c *FeishuDocClient) FetchAllDocuments(ctx context.Context) ([]*DocumentInfo, error) {
    var allDocs []*DocumentInfo
    
    // 1. è·å–æ ¹æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶
    rootFiles, err := c.fetchFolderFiles(ctx, "")
    if err != nil {
        return nil, err
    }
    
    // 2. é€’å½’è·å–å­æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶
    for _, folder := range rootFiles.Folders {
        subFiles, err := c.fetchFolderFiles(ctx, folder.Token)
        if err != nil {
            log.Printf("è·å–å­æ–‡ä»¶å¤¹å¤±è´¥ %s: %v", folder.Name, err)
            continue
        }
        allDocs = append(allDocs, subFiles.Documents...)
    }
    
    allDocs = append(allDocs, rootFiles.Documents...)
    
    return allDocs, nil
}

// è°ƒç”¨é£ä¹¦APIè·å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶
func (c *FeishuDocClient) fetchFolderFiles(ctx context.Context, folderToken string) (*FolderContent, error) {
    url := fmt.Sprintf("%s/open-apis/drive/v1/files", c.BaseURL)
    
    req := &http.Request{
        Method: "GET",
        URL:    parseURL(url),
        Header: map[string][]string{
            "Authorization": {fmt.Sprintf("Bearer %s", c.AccessToken)},
            "Content-Type":  {"application/json"},
        },
    }
    
    // æ·»åŠ æŸ¥è¯¢å‚æ•°
    q := req.URL.Query()
    if folderToken != "" {
        q.Add("folder_token", folderToken)
    }
    q.Add("page_size", "200") // æ¯é¡µæœ€å¤§200ä¸ª
    req.URL.RawQuery = q.Encode()
    
    resp, err := c.HTTPClient.Do(req)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()
    
    var result struct {
        Code int `json:"code"`
        Data struct {
            Files []struct {
                Token    string `json:"token"`
                Name     string `json:"name"`
                Type     string `json:"type"`     // "doc", "sheet", "bitable", "folder"
                URL      string `json:"url"`
                OwnerID  string `json:"owner_id"`
                Created  string `json:"created_time"`
                Modified string `json:"modified_time"`
            } `json:"files"`
            HasMore   bool   `json:"has_more"`
            PageToken string `json:"page_token"`
        } `json:"data"`
    }
    
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        return nil, err
    }
    
    // è½¬æ¢ä¸ºå†…éƒ¨æ•°æ®ç»“æ„
    folderContent := &FolderContent{
        Documents: []*DocumentInfo{},
        Folders:   []*FolderInfo{},
    }
    
    for _, file := range result.Data.Files {
        if file.Type == "folder" {
            folderContent.Folders = append(folderContent.Folders, &FolderInfo{
                Token: file.Token,
                Name:  file.Name,
            })
        } else if isDocumentType(file.Type) {
            // è·å–æ–‡æ¡£è¯¦ç»†ä¿¡æ¯
            docInfo := &DocumentInfo{
                Token:      file.Token,
                Type:       file.Type,
                Title:      file.Name,
                URL:        file.URL,
                Owner:      file.OwnerID,
                CreateTime: parseTime(file.Created),
                UpdateTime: parseTime(file.Modified),
            }
            folderContent.Documents = append(folderContent.Documents, docInfo)
        }
    }
    
    return folderContent, nil
}

// æ•°æ®åº“åŒæ­¥é€»è¾‘
func (s *DocumentSyncer) SyncDocumentsToDB(ctx context.Context, docs []*DocumentInfo) error {
    tx, err := s.db.Begin()
    if err != nil {
        return err
    }
    defer tx.Rollback()
    
    for _, doc := range docs {
        // æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å·²å­˜åœ¨
        var existingID int64
        err := tx.QueryRowContext(ctx, 
            "SELECT id FROM documents WHERE doc_token = ?", 
            doc.Token,
        ).Scan(&existingID)
        
        if err == sql.ErrNoRows {
            // æ’å…¥æ–°æ–‡æ¡£
            _, err = tx.ExecContext(ctx, `
                INSERT INTO documents (doc_token, doc_type, title, url, owner_id, owner_name, created_at, updated_at)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?)
            `, doc.Token, doc.Type, doc.Title, doc.URL, doc.Owner, doc.OwnerName, doc.CreateTime, doc.UpdateTime)
        } else if err == nil {
            // æ›´æ–°existingæ–‡æ¡£
            _, err = tx.ExecContext(ctx, `
                UPDATE documents 
                SET title = ?, url = ?, owner_name = ?, updated_at = ?, synced_at = NOW()
                WHERE id = ?
            `, doc.Title, doc.URL, doc.OwnerName, doc.UpdateTime, existingID)
        }
        
        if err != nil {
            return err
        }
    }
    
    return tx.Commit()
}
```

**2ï¸âƒ£ Document_Chunksè¡¨ - æ–‡æ¡£å†…å®¹åˆ†å—**

```go
// è·å–æ–‡æ¡£å†…å®¹å¹¶åˆ†å—
func (p *DocumentProcessor) ProcessDocumentContent(ctx context.Context, docToken, docType string) ([]*DocumentChunk, error) {
    // 1. è°ƒç”¨é£ä¹¦APIè·å–æ–‡æ¡£åŸå§‹å†…å®¹
    rawContent, err := p.feishuClient.GetRawDocumentContent(ctx, docToken, docType)
    if err != nil {
        return nil, fmt.Errorf("è·å–æ–‡æ¡£å†…å®¹å¤±è´¥: %w", err)
    }
    
    // 2. æ ¹æ®æ–‡æ¡£ç±»å‹è§£æå†…å®¹
    parsedContent, err := p.parseContentByType(rawContent, docType)
    if err != nil {
        return nil, fmt.Errorf("è§£ææ–‡æ¡£å†…å®¹å¤±è´¥: %w", err)
    }
    
    // 3. æ™ºèƒ½åˆ†å—
    chunks := p.splitContentIntoChunks(parsedContent)
    
    return chunks, nil
}

// é£ä¹¦æ–‡æ¡£å†…å®¹è·å–
func (c *FeishuDocClient) GetRawDocumentContent(ctx context.Context, docToken, docType string) (string, error) {
    var apiURL string
    
    switch docType {
    case "doc":
        // é£ä¹¦æ–‡æ¡£å†…å®¹API
        apiURL = fmt.Sprintf("%s/open-apis/docx/v1/documents/%s/raw_content", c.BaseURL, docToken)
    case "sheet":
        // é£ä¹¦è¡¨æ ¼å†…å®¹API
        apiURL = fmt.Sprintf("%s/open-apis/sheets/v3/spreadsheets/%s/values", c.BaseURL, docToken)
    case "bitable":
        // å¤šç»´è¡¨æ ¼å†…å®¹API
        apiURL = fmt.Sprintf("%s/open-apis/bitable/v1/apps/%s/tables", c.BaseURL, docToken)
    case "wiki":
        // çŸ¥è¯†åº“å†…å®¹API
        apiURL = fmt.Sprintf("%s/open-apis/wiki/v2/spaces/%s/nodes", c.BaseURL, docToken)
    default:
        return "", fmt.Errorf("ä¸æ”¯æŒçš„æ–‡æ¡£ç±»å‹: %s", docType)
    }
    
    req, err := http.NewRequestWithContext(ctx, "GET", apiURL, nil)
    if err != nil {
        return "", err
    }
    
    req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", c.AccessToken))
    req.Header.Set("Content-Type", "application/json")
    
    resp, err := c.HTTPClient.Do(req)
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()
    
    var result map[string]interface{}
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        return "", err
    }
    
    // æ ¹æ®ä¸åŒæ–‡æ¡£ç±»å‹æå–æ–‡æœ¬å†…å®¹
    return c.extractTextContent(result, docType), nil
}

// ä¿å­˜æ–‡æ¡£å—åˆ°æ•°æ®åº“
func (s *DocumentSyncer) SaveDocumentChunks(ctx context.Context, documentID int64, chunks []*DocumentChunk) error {
    tx, err := s.db.Begin()
    if err != nil {
        return err
    }
    defer tx.Rollback()
    
    // åˆ é™¤æ—§çš„chunks
    _, err = tx.ExecContext(ctx, "DELETE FROM document_chunks WHERE document_id = ?", documentID)
    if err != nil {
        return err
    }
    
    // æ’å…¥æ–°çš„chunks
    for i, chunk := range chunks {
        _, err = tx.ExecContext(ctx, `
            INSERT INTO document_chunks (document_id, chunk_index, content, content_type, char_count, metadata)
            VALUES (?, ?, ?, ?, ?, ?)
        `, documentID, i, chunk.Content, chunk.ContentType, len(chunk.Content), chunk.Metadata)
        
        if err != nil {
            return err
        }
    }
    
    // æ›´æ–°æ–‡æ¡£çš„åˆ†å—æ•°é‡
    _, err = tx.ExecContext(ctx, 
        "UPDATE documents SET chunk_count = ? WHERE id = ?", 
        len(chunks), documentID,
    )
    if err != nil {
        return err
    }
    
    return tx.Commit()
}
```

**3ï¸âƒ£ Usersè¡¨ - ç”¨æˆ·ä¿¡æ¯è·å–**

```go
// ç”¨æˆ·ä¿¡æ¯åŒæ­¥å™¨
type UserSyncer struct {
    feishuClient *FeishuDocClient
    db          *sql.DB
}

// ä»é£ä¹¦è·å–ç”¨æˆ·ä¿¡æ¯
func (s *UserSyncer) FetchUsersFromFeishu(ctx context.Context) ([]*UserInfo, error) {
    // 1. è·å–éƒ¨é—¨åˆ—è¡¨
    departments, err := s.feishuClient.GetDepartments(ctx)
    if err != nil {
        return nil, err
    }
    
    var allUsers []*UserInfo
    
    // 2. éå†æ¯ä¸ªéƒ¨é—¨è·å–ç”¨æˆ·
    for _, dept := range departments {
        users, err := s.feishuClient.GetDepartmentUsers(ctx, dept.ID)
        if err != nil {
            log.Printf("è·å–éƒ¨é—¨%sç”¨æˆ·å¤±è´¥: %v", dept.Name, err)
            continue
        }
        
        // 3. è·å–æ¯ä¸ªç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
        for _, user := range users {
            userDetail, err := s.feishuClient.GetUserDetail(ctx, user.UserID)
            if err != nil {
                log.Printf("è·å–ç”¨æˆ·%sè¯¦æƒ…å¤±è´¥: %v", user.UserID, err)
                continue
            }
            
            allUsers = append(allUsers, userDetail)
        }
    }
    
    return allUsers, nil
}

// é£ä¹¦APIè·å–ç”¨æˆ·è¯¦æƒ…
func (c *FeishuDocClient) GetUserDetail(ctx context.Context, userID string) (*UserInfo, error) {
    url := fmt.Sprintf("%s/open-apis/contact/v3/users/%s", c.BaseURL, userID)
    
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        return nil, err
    }
    
    req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", c.AccessToken))
    
    resp, err := c.HTTPClient.Do(req)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()
    
    var result struct {
        Code int `json:"code"`
        Data struct {
            User struct {
                UserID     string `json:"user_id"`
                Name       string `json:"name"`
                Avatar     struct {
                    Avatar200 string `json:"avatar_200"`
                } `json:"avatar"`
                Email      string `json:"email"`
                Department struct {
                    Name string `json:"name"`
                } `json:"department"`
            } `json:"user"`
        } `json:"data"`
    }
    
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        return nil, err
    }
    
    return &UserInfo{
        FeishuUserID: result.Data.User.UserID,
        Name:         result.Data.User.Name,
        Avatar:       result.Data.User.Avatar.Avatar200,
        Email:        result.Data.User.Email,
        Department:   result.Data.User.Department.Name,
    }, nil
}

// OAuthç™»å½•æ—¶ç”¨æˆ·ä¿¡æ¯è·å–å’Œæ›´æ–°
func (s *AuthService) HandleFeishuOAuth(ctx context.Context, code string) (*LoginResponse, error) {
    // 1. é€šè¿‡codeè·å–access_token
    token, err := s.feishuClient.ExchangeCodeForToken(ctx, code)
    if err != nil {
        return nil, err
    }
    
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯
    userInfo, err := s.feishuClient.GetCurrentUserInfo(ctx, token.AccessToken)
    if err != nil {
        return nil, err
    }
    
    // 3. æ›´æ–°æˆ–åˆ›å»ºæœ¬åœ°ç”¨æˆ·
    localUser, err := s.syncUserToDB(ctx, userInfo)
    if err != nil {
        return nil, err
    }
    
    // 4. ç”ŸæˆJWT token
    jwtToken, err := s.generateJWTToken(localUser)
    if err != nil {
        return nil, err
    }
    
    return &LoginResponse{
        Token:     jwtToken,
        ExpiresAt: time.Now().Add(24 * time.Hour),
        User:      localUser,
    }, nil
}
```

**4ï¸âƒ£ Document_Permissionsè¡¨ - æ–‡æ¡£æƒé™è·å–**

```go
// æ–‡æ¡£æƒé™åŒæ­¥å™¨
type PermissionSyncer struct {
    feishuClient *FeishuDocClient
    db          *sql.DB
}

// åŒæ­¥æ–‡æ¡£æƒé™
func (s *PermissionSyncer) SyncDocumentPermissions(ctx context.Context, docToken string, documentID int64) error {
    // 1. ä»é£ä¹¦è·å–æ–‡æ¡£æƒé™ä¿¡æ¯
    permissions, err := s.feishuClient.GetDocumentPermissions(ctx, docToken)
    if err != nil {
        return fmt.Errorf("è·å–æ–‡æ¡£æƒé™å¤±è´¥: %w", err)
    }
    
    // 2. å¼€å¯æ•°æ®åº“äº‹åŠ¡
    tx, err := s.db.BeginTx(ctx, nil)
    if err != nil {
        return err
    }
    defer tx.Rollback()
    
    // 3. åˆ é™¤æ—§æƒé™è®°å½•
    _, err = tx.ExecContext(ctx, 
        "DELETE FROM document_permissions WHERE document_id = ?", 
        documentID,
    )
    if err != nil {
        return err
    }
    
    // 4. æ’å…¥æ–°æƒé™è®°å½•
    for _, perm := range permissions {
        // ç¡®ä¿ç”¨æˆ·å­˜åœ¨äºæœ¬åœ°æ•°æ®åº“
        userID, err := s.ensureUserExists(ctx, tx, perm.UserID)
        if err != nil {
            log.Printf("åŒæ­¥ç”¨æˆ·%så¤±è´¥: %v", perm.UserID, err)
            continue
        }
        
        // æ’å…¥æƒé™è®°å½•
        _, err = tx.ExecContext(ctx, `
            INSERT INTO document_permissions (document_id, user_id, permission, granted_at)
            VALUES (?, ?, ?, NOW())
        `, documentID, userID, perm.Permission)
        
        if err != nil {
            return err
        }
    }
    
    return tx.Commit()
}

// ä»é£ä¹¦APIè·å–æ–‡æ¡£æƒé™
func (c *FeishuDocClient) GetDocumentPermissions(ctx context.Context, docToken string) ([]*DocumentPermission, error) {
    url := fmt.Sprintf("%s/open-apis/drive/v1/permissions/%s/members", c.BaseURL, docToken)
    
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        return nil, err
    }
    
    req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", c.AccessToken))
    req.Header.Set("Content-Type", "application/json")
    
    resp, err := c.HTTPClient.Do(req)
    if err != nil {
        return nil, err
    }
    defer resp.Body.Close()
    
    var result struct {
        Code int `json:"code"`
        Data struct {
            Items []struct {
                MemberType   string `json:"member_type"`   // "user"
                MemberID     string `json:"member_id"`     // ç”¨æˆ·ID
                Perm         string `json:"perm"`          // "view", "edit", "full_access"
                MemberDetail struct {
                    User struct {
                        Name   string `json:"name"`
                        Avatar string `json:"avatar"`
                    } `json:"user"`
                } `json:"member_detail"`
            } `json:"items"`
        } `json:"data"`
    }
    
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        return nil, err
    }
    
    var permissions []*DocumentPermission
    for _, item := range result.Data.Items {
        if item.MemberType == "user" {
            permission := mapFeishuPermission(item.Perm) // "view"->viewer, "edit"->editor, "full_access"->owner
            
            permissions = append(permissions, &DocumentPermission{
                UserID:     item.MemberID,
                Permission: permission,
                UserName:   item.MemberDetail.User.Name,
                UserAvatar: item.MemberDetail.User.Avatar,
            })
        }
    }
    
    return permissions, nil
}

// ç¡®ä¿ç”¨æˆ·å­˜åœ¨äºæœ¬åœ°æ•°æ®åº“
func (s *PermissionSyncer) ensureUserExists(ctx context.Context, tx *sql.Tx, feishuUserID string) (int64, error) {
    var userID int64
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
    err := tx.QueryRowContext(ctx, 
        "SELECT id FROM users WHERE feishu_user_id = ?", 
        feishuUserID,
    ).Scan(&userID)
    
    if err == nil {
        return userID, nil // ç”¨æˆ·å·²å­˜åœ¨
    }
    
    if err != sql.ErrNoRows {
        return 0, err // å…¶ä»–é”™è¯¯
    }
    
    // ç”¨æˆ·ä¸å­˜åœ¨ï¼Œä»é£ä¹¦è·å–ç”¨æˆ·ä¿¡æ¯å¹¶åˆ›å»º
    userInfo, err := s.feishuClient.GetUserDetail(ctx, feishuUserID)
    if err != nil {
        return 0, fmt.Errorf("è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥: %w", err)
    }
    
    // åˆ›å»ºæ–°ç”¨æˆ·
    result, err := tx.ExecContext(ctx, `
        INSERT INTO users (feishu_user_id, name, avatar_url, email, department, created_at)
        VALUES (?, ?, ?, ?, ?, NOW())
    `, userInfo.FeishuUserID, userInfo.Name, userInfo.Avatar, userInfo.Email, userInfo.Department)
    
    if err != nil {
        return 0, err
    }
    
    userID, err = result.LastInsertId()
    return userID, err
}
```

**ğŸ”„ å®šæ—¶åŒæ­¥ç­–ç•¥ï¼š**

```go
// å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
func (s *SyncScheduler) StartScheduledSync() {
    // æ¯å°æ—¶å…¨é‡åŒæ­¥æ–‡æ¡£åˆ—è¡¨
    c1 := cron.New()
    c1.AddFunc("0 0 * * * *", func() {
        s.FullDocumentSync()
    })
    
    // æ¯30åˆ†é’ŸåŒæ­¥ç”¨æˆ·ä¿¡æ¯
    c1.AddFunc("0 */30 * * * *", func() {
        s.UserSync()
    })
    
    // æ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†è¿‡æœŸæ•°æ®
    c1.AddFunc("0 0 2 * * *", func() {
        s.CleanupExpiredData()
    })
    
    c1.Start()
}
```

#### æ•°æ®è·å–æ ¸å¿ƒäº®ç‚¹ä¸ä¼˜åŠ¿

**ğŸ¯ æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹ï¼š**

**1. Documentsè¡¨ - æ™ºèƒ½æ–‡æ¡£å‘ç°**
- **é€’å½’éå†ç®—æ³•**ï¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰æ–‡ä»¶å¤¹å’Œå­æ–‡ä»¶å¤¹ä¸­çš„æ–‡æ¡£ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- **å¢é‡åŒæ­¥æœºåˆ¶**ï¼šé€šè¿‡ `content_hash` å­—æ®µæ£€æµ‹æ–‡æ¡£å†…å®¹å˜æ›´ï¼Œé¿å…ä¸å¿…è¦çš„é‡å¤å¤„ç†
- **å¤šç±»å‹å…¨è¦†ç›–**ï¼šdoc/sheet/bitable/wiki å…¨ç±»å‹æ”¯æŒï¼Œæ»¡è¶³ä¼ä¸šå„ç§æ–‡æ¡£éœ€æ±‚
- **å®¹é”™èƒ½åŠ›å¼º**ï¼šå•ä¸ªæ–‡æ¡£åŒæ­¥å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§

**2. Document_Chunksè¡¨ - æ™ºèƒ½å†…å®¹å¤„ç†**
- **å¤šæ ¼å¼æ™ºèƒ½è§£æ**ï¼šé’ˆå¯¹ä¸åŒæ–‡æ¡£ç±»å‹ä½¿ç”¨å¯¹åº”çš„é£ä¹¦ä¸“ç”¨API
- **åŸºäºEinoçš„åˆ†å—ç®—æ³•**ï¼šæ™ºèƒ½åˆ†å‰²ç­–ç•¥ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´æ€§
- **å‘é‡å…³è”æœºåˆ¶**ï¼šæ¯ä¸ªchunkç²¾ç¡®å…³è”åˆ°Milvusä¸­çš„å‘é‡IDï¼Œæ”¯æŒé«˜æ•ˆæ£€ç´¢
- **åŸå­äº‹åŠ¡ä¿è¯**ï¼šç¡®ä¿MySQLå’ŒMilvusæ•°æ®åº“çš„ä¸€è‡´æ€§

**3. Usersè¡¨ - å®Œæ•´ç”¨æˆ·ç”»åƒæ„å»º**
- **éƒ¨é—¨ç»“æ„éå†**ï¼šé€šè¿‡ä¼ä¸šç»„ç»‡æ¶æ„è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
- **OAuthæ— ç¼é›†æˆ**ï¼šç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨åŒæ­¥æœ€æ–°ä¸ªäººä¿¡æ¯
- **æ‡’åŠ è½½ç”¨æˆ·æœºåˆ¶**ï¼šæƒé™åŒæ­¥æ—¶æŒ‰éœ€åˆ›å»ºï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®å†—ä½™
- **ä¿¡æ¯ç»´åº¦å®Œæ•´**ï¼šå¤´åƒã€é‚®ç®±ã€éƒ¨é—¨ç­‰è¯¦ç»†ä¿¡æ¯ä¸€åº”ä¿±å…¨

**4. Document_Permissionsè¡¨ - ç²¾ç¡®æƒé™æ§åˆ¶**
- **å®æ—¶æƒé™åŒæ­¥**ï¼šæ–‡æ¡£æƒé™å˜æ›´ç«‹å³åæ˜ åˆ°æœ¬åœ°æ•°æ®åº“
- **æƒé™è¯­ä¹‰æ˜ å°„**ï¼šé£ä¹¦æƒé™ä½“ç³»åˆ°æœ¬åœ°æƒé™çš„å‡†ç¡®è½¬æ¢
- **å…³è”ç”¨æˆ·ç®¡ç†**ï¼šè‡ªåŠ¨ç»´æŠ¤æƒé™ç›¸å…³ç”¨æˆ·çš„æœ¬åœ°è®°å½•
- **ä¸‰çº§æƒé™ä½“ç³»**ï¼šowner/editor/viewer ç²¾ç»†åŒ–æƒé™æ§åˆ¶

**ğŸ”„ åŒæ­¥ç­–ç•¥ç‰¹è‰²ï¼š**

**å®æ—¶åŒæ­¥ï¼ˆWebhooké©±åŠ¨ï¼‰**
```
é£ä¹¦æ–‡æ¡£å˜æ›´äº‹ä»¶ â†’ Webhookå®æ—¶æ¥æ”¶ â†’ æ™ºèƒ½å¢é‡åŒæ­¥ â†’ 
æ•°æ®åº“å³æ—¶æ›´æ–° â†’ å‘é‡åº“åŒæ­¥æ›´æ–° â†’ ç”¨æˆ·ç«‹å³å¯è§
```

**å®šæ—¶åŒæ­¥ï¼ˆå®¹é”™ä¿è¯ï¼‰**
```
æ¯å°æ—¶: å…¨é‡æ–‡æ¡£åˆ—è¡¨åŒæ­¥ï¼ˆå‘ç°æ–°æ–‡æ¡£ã€æ£€æµ‹åˆ é™¤ï¼‰
æ¯30åˆ†é’Ÿ: ç”¨æˆ·ä¿¡æ¯åŒæ­¥ï¼ˆç»„ç»‡æ¶æ„å˜æ›´ã€äººå‘˜è°ƒæ•´ï¼‰
æ¯å¤©å‡Œæ™¨: æ•°æ®æ¸…ç†å’Œä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæ¸…ç†å­¤å„¿æ•°æ®ï¼‰
```

**æ™ºèƒ½å»é‡ä¸å¢é‡æ›´æ–°**
```
æ•°æ®è·å– â†’ æœ¬åœ°è®°å½•æ£€æŸ¥ â†’ æ—¶é—´æˆ³æ¯”è¾ƒ â†’ 
å†…å®¹hashéªŒè¯ â†’ å¢é‡æ›´æ–°ç­–ç•¥ â†’ ä¿æŒæ•°æ®æ–°é²œåº¦
```

**ğŸš€ æŠ€æœ¯ä¼˜åŒ–äº®ç‚¹ï¼š**

**1. äº‹åŠ¡ç®¡ç†ä¸æ•°æ®ä¸€è‡´æ€§**
- æ‰€æœ‰å…³é”®æ•°æ®åº“æ“ä½œéƒ½åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ
- è·¨è¡¨æ•°æ®æ›´æ–°ä¿è¯åŸå­æ€§
- å¤±è´¥å›æ»šæœºåˆ¶ç¡®ä¿æ•°æ®å®Œæ•´æ€§

**2. å®¹é”™ä¸é”™è¯¯å¤„ç†**
- å•ç‚¹æ•…éšœéš”ç¦»ï¼Œä¸å½±å“æ•´ä½“æœåŠ¡
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œç›‘æ§æŒ‡æ ‡
- è‡ªåŠ¨é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥

**3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- æ‰¹é‡æ•°æ®æ“ä½œå‡å°‘æ•°æ®åº“è¿æ¥å¼€é”€
- åˆ†é¡µè·å–å¤§é‡æ•°æ®é¿å…å†…å­˜æº¢å‡º
- å¹¶å‘æ§åˆ¶å¹³è¡¡æ•ˆç‡ä¸ç¨³å®šæ€§

**4. APIè°ƒç”¨ç®¡ç†**
- éµå¾ªé£ä¹¦APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- Tokenè‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- è¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•ä¸é€€é¿

**5. æ•°æ®è´¨é‡ä¿è¯**
- å¤–é”®çº¦æŸç»´æŠ¤æ•°æ®å…³ç³»å®Œæ•´æ€§
- ç´¢å¼•ä¼˜åŒ–æå‡æŸ¥è¯¢æ€§èƒ½
- æ•°æ®éªŒè¯ç¡®ä¿å­˜å‚¨è´¨é‡

**ğŸ“Š åŒæ­¥æ•ˆæœé¢„æœŸï¼š**

| æŒ‡æ ‡ | å®æ—¶åŒæ­¥ | å®šæ—¶åŒæ­¥ | ç›®æ ‡å€¼ |
|------|---------|---------|--------|
| **æ–‡æ¡£å‘ç°å»¶è¿Ÿ** | < 5ç§’ | < 1å°æ—¶ | 99.9%åŠæ—¶æ€§ |
| **æƒé™åŒæ­¥å‡†ç¡®ç‡** | 100% | 99.9% | é›¶æƒé™é”™è¯¯ |
| **ç”¨æˆ·ä¿¡æ¯æ–°é²œåº¦** | ç™»å½•æ—¶ | 30åˆ†é’Ÿ | 95%ä¿¡æ¯å‡†ç¡® |
| **æ•°æ®ä¸€è‡´æ€§** | å¼ºä¸€è‡´ | æœ€ç»ˆä¸€è‡´ | 99.99%ä¸€è‡´ç‡ |

**ğŸ”§ å®æ–½ä¼˜å…ˆçº§å»ºè®®ï¼š**

**Phase 1: åŸºç¡€æ•°æ®å»ºè®¾ï¼ˆç¬¬1-2å‘¨ï¼‰**
1. å®ç°Documentsè¡¨åŒæ­¥ï¼Œå»ºç«‹æ–‡æ¡£åŸºç¡€æ•°æ®
2. æ­å»ºåŸºç¡€çš„é£ä¹¦APIé›†æˆæ¡†æ¶
3. å®ç°ç®€å•çš„å®šæ—¶åŒæ­¥æœºåˆ¶

**Phase 2: ç”¨æˆ·ä½“ç³»å»ºè®¾ï¼ˆç¬¬3å‘¨ï¼‰**
1. å®ç°Usersè¡¨åŒæ­¥ï¼Œæ”¯æŒç”¨æˆ·è®¤è¯
2. é›†æˆé£ä¹¦OAuthç™»å½•æµç¨‹
3. å»ºç«‹ç”¨æˆ·æƒé™åŸºç¡€æ¡†æ¶

**Phase 3: å†…å®¹å¤„ç†èƒ½åŠ›ï¼ˆç¬¬4-5å‘¨ï¼‰**
1. å®ç°Document_Chunkså†…å®¹è§£æå’Œåˆ†å—
2. é›†æˆEinoæ–‡æ¡£å¤„ç†æµæ°´çº¿
3. å»ºç«‹å‘é‡åŒ–å’Œå­˜å‚¨æœºåˆ¶

**Phase 4: æƒé™æ§åˆ¶å®Œå–„ï¼ˆç¬¬6å‘¨ï¼‰**
1. å®ç°Document_Permissionsç²¾ç¡®æƒé™æ§åˆ¶
2. å»ºç«‹æƒé™éªŒè¯å’Œè®¿é—®æ§åˆ¶æœºåˆ¶
3. å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç•Œé¢

**Phase 5: ä¼˜åŒ–ä¸ç›‘æ§ï¼ˆç¬¬7-8å‘¨ï¼‰**
1. ä¼˜åŒ–åŒæ­¥æ€§èƒ½å’Œé”™è¯¯å¤„ç†
2. å»ºç«‹å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
3. å‹åŠ›æµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜

**ğŸ’¡ å…³é”®æˆåŠŸå› ç´ ï¼š**

1. **é£ä¹¦APIæƒé™é…ç½®**ï¼šç¡®ä¿è·å¾—è¶³å¤Ÿçš„APIè°ƒç”¨æƒé™
2. **æ•°æ®åº“æ€§èƒ½è°ƒä¼˜**ï¼šé’ˆå¯¹å¤§é‡æ–‡æ¡£çš„å­˜å‚¨å’ŒæŸ¥è¯¢ä¼˜åŒ–
3. **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ¢å¤ç­–ç•¥
4. **ç›‘æ§å‘Šè­¦ä½“ç³»**ï¼šåŠæ—¶å‘ç°å’Œè§£å†³åŒæ­¥é—®é¢˜
5. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼šä¿è¯æ•°æ®åŒæ­¥å¯¹ç”¨æˆ·çš„é€æ˜æ€§

è¿™å¥—æ•°æ®è·å–æ–¹æ¡ˆä¸ä»…æŠ€æœ¯å…ˆè¿›ï¼Œè¿˜å……åˆ†è€ƒè™‘äº†ä¼ä¸šçº§åº”ç”¨çš„ç¨³å®šæ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§éœ€æ±‚ï¼

### 28. APIæ¥å£è®¾è®¡

#### RESTful APIè§„èŒƒ
```go
// API Base URL: https://doc-ai.yourcompany.com/api/v1

// 1. è®¤è¯ç›¸å…³æ¥å£
type AuthAPI struct{}

// POST /api/v1/auth/login - ç”¨æˆ·ç™»å½•
type LoginRequest struct {
    Code string `json:"code" binding:"required"` // é£ä¹¦æˆæƒç 
}

type LoginResponse struct {
    Token     string    `json:"token"`
    ExpiresAt time.Time `json:"expires_at"`
    User      UserInfo  `json:"user"`
}

// GET /api/v1/auth/profile - è·å–ç”¨æˆ·ä¿¡æ¯
type UserInfo struct {
    ID         int64  `json:"id"`
    Name       string `json:"name"`
    Avatar     string `json:"avatar"`
    Email      string `json:"email"`
    Department string `json:"department"`
    Role       string `json:"role"`
}

// 2. æ–‡æ¡£ç›¸å…³æ¥å£
type DocumentAPI struct{}

// GET /api/v1/documents - è·å–æ–‡æ¡£åˆ—è¡¨
type GetDocumentsRequest struct {
    Page     int    `form:"page,default=1"`
    PageSize int    `form:"page_size,default=20"`
    Type     string `form:"type"`        // æ–‡æ¡£ç±»å‹è¿‡æ»¤
    Owner    string `form:"owner"`       // æ‰€æœ‰è€…è¿‡æ»¤
    Keyword  string `form:"keyword"`     // å…³é”®è¯æœç´¢
    StartDate string `form:"start_date"` // å¼€å§‹æ—¥æœŸ
    EndDate   string `form:"end_date"`   // ç»“æŸæ—¥æœŸ
}

type GetDocumentsResponse struct {
    Documents []DocumentInfo `json:"documents"`
    Total     int64          `json:"total"`
    Page      int            `json:"page"`
    PageSize  int            `json:"page_size"`
}

type DocumentInfo struct {
    ID          int64     `json:"id"`
    DocToken    string    `json:"doc_token"`
    Type        string    `json:"type"`
    Title       string    `json:"title"`
    URL         string    `json:"url"`
    Owner       string    `json:"owner"`
    WordCount   int       `json:"word_count"`
    ChunkCount  int       `json:"chunk_count"`
    Status      string    `json:"status"`
    CreatedAt   time.Time `json:"created_at"`
    UpdatedAt   time.Time `json:"updated_at"`
    SyncedAt    *time.Time `json:"synced_at"`
}

// POST /api/v1/documents/sync - æ‰‹åŠ¨åŒæ­¥æ–‡æ¡£
type SyncDocumentsRequest struct {
    DocTokens []string `json:"doc_tokens"` // æŒ‡å®šæ–‡æ¡£ï¼Œç©ºåˆ™å…¨é‡åŒæ­¥
    Force     bool     `json:"force"`      // å¼ºåˆ¶é‡æ–°åŒæ­¥
}

type SyncDocumentsResponse struct {
    TaskID string `json:"task_id"`
    Status string `json:"status"`
}

// 3. é—®ç­”ç›¸å…³æ¥å£
type QAAPI struct{}

// POST /api/v1/qa/ask - æé—®æ¥å£
type AskRequest struct {
    Question   string            `json:"question" binding:"required"`
    SessionID  string            `json:"session_id"`
    Context    map[string]interface{} `json:"context"`
    Filters    map[string]interface{} `json:"filters"` // æ–‡æ¡£ç±»å‹ã€æ—¶é—´èŒƒå›´ç­‰è¿‡æ»¤
}

type AskResponse struct {
    Answer       string           `json:"answer"`
    SessionID    string           `json:"session_id"`
    Sources      []SourceDocument `json:"sources"`      // å‚è€ƒæ–‡æ¡£
    Confidence   float64          `json:"confidence"`   // ç½®ä¿¡åº¦
    ResponseTime int              `json:"response_time"` // å“åº”æ—¶é—´ms
    TokensUsed   int              `json:"tokens_used"`   // tokenæ¶ˆè€—
}

type SourceDocument struct {
    DocID     int64   `json:"doc_id"`
    Title     string  `json:"title"`
    URL       string  `json:"url"`
    Excerpt   string  `json:"excerpt"`   // ç›¸å…³ç‰‡æ®µ
    Score     float64 `json:"score"`     // ç›¸å…³åº¦åˆ†æ•°
    ChunkIndex int    `json:"chunk_index"`
}

// GET /api/v1/qa/sessions/{session_id}/history - è·å–å¯¹è¯å†å²
type GetHistoryResponse struct {
    SessionID string    `json:"session_id"`
    Messages  []Message `json:"messages"`
}

type Message struct {
    Type      string    `json:"type"`      // "question" | "answer"
    Content   string    `json:"content"`
    Timestamp time.Time `json:"timestamp"`
    Sources   []SourceDocument `json:"sources,omitempty"`
}

// POST /api/v1/qa/feedback - åé¦ˆè¯„ä»·
type FeedbackRequest struct {
    SessionID string `json:"session_id" binding:"required"`
    MessageID string `json:"message_id" binding:"required"`
    Score     int    `json:"score" binding:"required,min=1,max=5"` // 1-5åˆ†
    Comment   string `json:"comment"`
}

// 4. ç»Ÿè®¡åˆ†ææ¥å£
type AnalyticsAPI struct{}

// GET /api/v1/analytics/dashboard - ä»ªè¡¨æ¿æ•°æ®
type DashboardResponse struct {
    DocumentStats DocumentStats `json:"document_stats"`
    QAStats       QAStats       `json:"qa_stats"`
    UserStats     UserStats     `json:"user_stats"`
    SyncStats     SyncStats     `json:"sync_stats"`
}

type DocumentStats struct {
    TotalDocs     int64 `json:"total_docs"`
    DocsToday     int64 `json:"docs_today"`
    DocsThisWeek  int64 `json:"docs_this_week"`
    DocsThisMonth int64 `json:"docs_this_month"`
    TypeDistribution map[string]int64 `json:"type_distribution"`
}

type QAStats struct {
    TotalQuestions int64   `json:"total_questions"`
    QuestionsToday int64   `json:"questions_today"`
    AvgResponseTime int    `json:"avg_response_time"`
    AvgSatisfaction float64 `json:"avg_satisfaction"`
    PopularQuestions []string `json:"popular_questions"`
}

// 5. ç®¡ç†å‘˜æ¥å£
type AdminAPI struct{}

// GET /api/v1/admin/sync/logs - è·å–åŒæ­¥æ—¥å¿—
type GetSyncLogsResponse struct {
    Logs []SyncLog `json:"logs"`
    Total int64    `json:"total"`
}

type SyncLog struct {
    ID            int64     `json:"id"`
    SyncType      string    `json:"sync_type"`
    Status        string    `json:"status"`
    TotalDocs     int       `json:"total_docs"`
    ProcessedDocs int       `json:"processed_docs"`
    FailedDocs    int       `json:"failed_docs"`
    ErrorMessage  string    `json:"error_message,omitempty"`
    StartedAt     time.Time `json:"started_at"`
    CompletedAt   *time.Time `json:"completed_at"`
}

// POST /api/v1/admin/config - æ›´æ–°ç³»ç»Ÿé…ç½®
type UpdateConfigRequest struct {
    Configs map[string]interface{} `json:"configs"`
}
```

### 29. å‰ç«¯ç»„ä»¶ç»“æ„

#### React/TypeScript ç»„ä»¶æ¶æ„
```typescript
// é¡¹ç›®ç»“æ„
src/
â”œâ”€â”€ components/          // é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ Loading.tsx
â”‚   â”‚   â”œâ”€â”€ Toast.tsx
â”‚   â”‚   â””â”€â”€ ErrorBoundary.tsx
â”‚   â”œâ”€â”€ forms/
â”‚   â”‚   â”œâ”€â”€ SearchBox.tsx
â”‚   â”‚   â”œâ”€â”€ FilterPanel.tsx
â”‚   â”‚   â””â”€â”€ DateRangePicker.tsx
â”‚   â””â”€â”€ charts/
â”‚       â”œâ”€â”€ DocumentChart.tsx
â”‚       â””â”€â”€ UsageChart.tsx
â”œâ”€â”€ pages/               // é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ DocumentStats.tsx
â”‚   â”‚   â””â”€â”€ QAStats.tsx
â”‚   â”œâ”€â”€ Chat/
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ ChatWindow.tsx
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â”œâ”€â”€ MessageItem.tsx
â”‚   â”‚   â”œâ”€â”€ InputBox.tsx
â”‚   â”‚   â””â”€â”€ SourcePanel.tsx
â”‚   â”œâ”€â”€ Documents/
â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”œâ”€â”€ DocumentList.tsx
â”‚   â”‚   â”œâ”€â”€ DocumentCard.tsx
â”‚   â”‚   â””â”€â”€ DocumentDetail.tsx
â”‚   â””â”€â”€ Admin/
â”‚       â”œâ”€â”€ index.tsx
â”‚       â”œâ”€â”€ SyncManager.tsx
â”‚       â”œâ”€â”€ UserManager.tsx
â”‚       â””â”€â”€ ConfigManager.tsx
â”œâ”€â”€ hooks/               // è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useChat.ts
â”‚   â”œâ”€â”€ useDocuments.ts
â”‚   â””â”€â”€ useWebSocket.ts
â”œâ”€â”€ services/            // APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ chat.ts
â”‚   â””â”€â”€ documents.ts
â”œâ”€â”€ store/               // çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ authSlice.ts
â”‚   â”œâ”€â”€ chatSlice.ts
â”‚   â””â”€â”€ documentsSlice.ts
â”œâ”€â”€ types/               // ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ chat.ts
â”‚   â””â”€â”€ document.ts
â”œâ”€â”€ utils/               // å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ request.ts
â”‚   â”œâ”€â”€ format.ts
â”‚   â””â”€â”€ constants.ts
â””â”€â”€ styles/              // æ ·å¼æ–‡ä»¶
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ components.css
    â””â”€â”€ variables.css
```

#### æ ¸å¿ƒç»„ä»¶å®ç°
```typescript
// 1. ä¸»èŠå¤©ç»„ä»¶
interface ChatWindowProps {
  sessionId?: string;
  onNewSession: (sessionId: string) => void;
}

const ChatWindow: React.FC<ChatWindowProps> = ({ sessionId, onNewSession }) => {
  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const { sendMessage, history } = useChat(sessionId);

  const handleSendMessage = async (question: string) => {
    setIsLoading(true);
    try {
      const response = await sendMessage(question);
      setMessages(prev => [...prev, 
        { type: 'question', content: question, timestamp: new Date() },
        { type: 'answer', content: response.answer, sources: response.sources, timestamp: new Date() }
      ]);
    } catch (error) {
      // é”™è¯¯å¤„ç†
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="chat-window">
      <MessageList messages={messages} />
      <InputBox onSend={handleSendMessage} disabled={isLoading} />
      {isLoading && <Loading />}
    </div>
  );
};

// 2. æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
const MessageList: React.FC<{ messages: Message[] }> = ({ messages }) => {
  return (
    <div className="message-list">
      {messages.map((message, index) => (
        <MessageItem 
          key={index} 
          message={message}
          showSources={message.type === 'answer'}
        />
      ))}
    </div>
  );
};

// 3. æ–‡æ¡£æœç´¢ç»„ä»¶
const DocumentSearch: React.FC = () => {
  const [filters, setFilters] = useState<DocumentFilters>({});
  const { documents, loading, searchDocuments } = useDocuments();

  return (
    <div className="document-search">
      <SearchBox onSearch={searchDocuments} />
      <FilterPanel filters={filters} onChange={setFilters} />
      <DocumentList documents={documents} loading={loading} />
    </div>
  );
};

// 4. ä»ªè¡¨æ¿ç»„ä»¶
const Dashboard: React.FC = () => {
  const { stats, loading } = useDashboardStats();

  if (loading) return <Loading />;

  return (
    <div className="dashboard">
      <div className="stats-grid">
        <DocumentStats stats={stats.documentStats} />
        <QAStats stats={stats.qaStats} />
        <UserStats stats={stats.userStats} />
        <SyncStats stats={stats.syncStats} />
      </div>
      <div className="charts-section">
        <DocumentChart data={stats.documentTrends} />
        <UsageChart data={stats.usageTrends} />
      </div>
    </div>
  );
};

// 5. è‡ªå®šä¹‰Hooks
const useChat = (sessionId?: string) => {
  const [history, setHistory] = useState<Message[]>([]);
  
  const sendMessage = async (question: string) => {
    const response = await fetch('/api/v1/qa/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question, session_id: sessionId })
    });
    return response.json();
  };

  const loadHistory = async () => {
    if (sessionId) {
      const response = await fetch(`/api/v1/qa/sessions/${sessionId}/history`);
      const data = await response.json();
      setHistory(data.messages);
    }
  };

  useEffect(() => {
    loadHistory();
  }, [sessionId]);

  return { sendMessage, history, loadHistory };
};
```

### 30. éƒ¨ç½²æ¶æ„

#### å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
```yaml
# docker-compose.yml
version: '3.8'

services:
  # Nginx ç½‘å…³
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
      - ./nginx/logs:/var/log/nginx
    depends_on:
      - api-server
      - web-app
    networks:
      - feishu-network

  # APIæœåŠ¡ (å¤šå®ä¾‹)
  api-server:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
    environment:
      - GO_ENV=production
      - MYSQL_HOST=mysql
      - REDIS_HOST=redis
      - MILVUS_HOST=milvus-standalone
    volumes:
      - ./configs:/app/configs
      - ./logs:/app/logs
    depends_on:
      - mysql
      - redis
      - milvus-standalone
    deploy:
      replicas: 3
    networks:
      - feishu-network

  # Webå‰ç«¯
  web-app:
    build:
      context: ./web
      dockerfile: Dockerfile
    environment:
      - NODE_ENV=production
      - REACT_APP_API_BASE_URL=https://doc-ai.yourcompany.com/api
    networks:
      - feishu-network

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=feishu_doc_ai
      - MYSQL_USER=app_user
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - feishu-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis-data:/data
    ports:
      - "6379:6379"
    networks:
      - feishu-network

  # Milvuså‘é‡æ•°æ®åº“
  etcd:
    container_name: milvus-etcd
    image: quay.io/coreos/etcd:v3.5.0
    environment:
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
    volumes:
      - etcd-data:/etcd
    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd
    networks:
      - feishu-network

  minio:
    container_name: milvus-minio
    image: minio/minio:RELEASE.2022-03-17T06-34-49Z
    environment:
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadmin
    volumes:
      - minio-data:/data
    command: minio server /data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
    networks:
      - feishu-network

  milvus-standalone:
    container_name: milvus-standalone
    image: milvusdb/milvus:v2.3.1
    command: ["milvus", "run", "standalone"]
    environment:
      ETCD_ENDPOINTS: etcd:2379
      MINIO_ADDRESS: minio:9000
    volumes:
      - milvus-data:/var/lib/milvus
    ports:
      - "19530:19530"
      - "9091:9091"
    depends_on:
      - "etcd"
      - "minio"
    networks:
      - feishu-network

  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    networks:
      - feishu-network

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana:/etc/grafana/provisioning
    networks:
      - feishu-network

volumes:
  mysql-data:
  redis-data:
  milvus-data:
  etcd-data:
  minio-data:
  prometheus-data:
  grafana-data:

networks:
  feishu-network:
    driver: bridge
```

#### Kuberneteséƒ¨ç½²é…ç½®
```yaml
# k8s/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: feishu-doc-ai

---
# k8s/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: feishu-doc-ai
data:
  config.yaml: |
    app:
      name: "é£ä¹¦æ–‡æ¡£AIåŠ©æ‰‹"
      port: 8080
    feishu:
      app_id: "${FEISHU_APP_ID}"
      app_secret: "${FEISHU_APP_SECRET}"
    # ... å…¶ä»–é…ç½®

---
# k8s/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secret
  namespace: feishu-doc-ai
type: Opaque
data:
  mysql-password: <base64-encoded-password>
  redis-password: <base64-encoded-password>
  openai-api-key: <base64-encoded-key>

---
# k8s/api-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-server
  namespace: feishu-doc-ai
spec:
  replicas: 3
  selector:
    matchLabels:
      app: api-server
  template:
    metadata:
      labels:
        app: api-server
    spec:
      containers:
      - name: api-server
        image: feishu-doc-ai/api-server:latest
        ports:
        - containerPort: 8080
        - containerPort: 8081  # webhook port
        env:
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secret
              key: mysql-password
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-secret
              key: redis-password
        volumeMounts:
        - name: config-volume
          mountPath: /app/configs
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi" 
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /api/v1/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /api/v1/health
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: config-volume
        configMap:
          name: app-config

---
# k8s/api-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: api-server-service
  namespace: feishu-doc-ai
spec:
  selector:
    app: api-server
  ports:
  - name: http
    port: 80
    targetPort: 8080
  - name: webhook
    port: 8081
    targetPort: 8081
  type: ClusterIP

---
# k8s/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  namespace: feishu-doc-ai
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  tls:
  - hosts:
    - doc-ai.yourcompany.com
    secretName: app-tls
  rules:
  - host: doc-ai.yourcompany.com
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: api-server-service
            port:
              number: 80
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web-app-service
            port:
              number: 80

---
# k8s/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-server-hpa
  namespace: feishu-doc-ai
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api-server
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### åŸºç¡€è®¾æ–½éœ€æ±‚

**æœåŠ¡å™¨é…ç½®:**
- **CPU**: 4æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 16GBä»¥ä¸Š  
- **å­˜å‚¨**: 500GB SSD
- **ç½‘ç»œ**: 10Mbpsä»¥ä¸Šå¸¦å®½

**ä¾èµ–æœåŠ¡:**
```yaml
version: '3.8'
services:
  # Milvuså‘é‡æ•°æ®åº“
  milvus:
    image: milvusdb/milvus:latest
    ports:
      - "19530:19530"
    volumes:
      - milvus_data:/var/lib/milvus
    environment:
      - MILVUS_CONFIG_PATH=/milvus/configs/milvus.yaml
  
  # MySQLå…ƒæ•°æ®å­˜å‚¨
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=your_password
      - MYSQL_DATABASE=document_ai
    volumes:
      - mysql_data:/var/lib/mysql
  
  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
  
  # åº”ç”¨ä¸»æœåŠ¡
  document-ai:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - milvus
      - mysql
      - redis
    environment:
      - MILVUS_HOST=milvus
      - MYSQL_HOST=mysql
      - REDIS_HOST=redis
    volumes:
      - ./documents:/app/documents
      - ./logs:/app/logs

volumes:
  milvus_data:
  mysql_data:
  redis_data:
```

### ç¯å¢ƒé…ç½®

**åº”ç”¨é…ç½®æ–‡ä»¶ (`config.yaml`):**
```yaml
# åº”ç”¨é…ç½®
app:
  name: "äº§å“æ–‡æ¡£AIåŠ©æ‰‹"
  version: "1.0.0"
  host: "0.0.0.0"
  port: 8080
  debug: false

# æ•°æ®åº“é…ç½®
database:
  milvus:
    host: "localhost"
    port: 19530
    collection_name: "product_docs"
    
  mysql:
    host: "localhost"
    port: 3306
    username: "root"
    password: "your_password"
    database: "document_ai"
    
  redis:
    host: "localhost"
    port: 6379
    password: ""
    db: 0

# AIæ¨¡å‹é…ç½®
models:
  embedding:
    provider: "openai"
    model: "text-embedding-ada-002"
    api_key: "${OPENAI_API_KEY}"
    
  chat:
    provider: "openai"
    model: "gpt-4"
    api_key: "${OPENAI_API_KEY}"
    temperature: 0.1
    max_tokens: 2000

# æ–‡æ¡£ç›‘æ§é…ç½®
monitoring:
  watch_paths:
    - "/data/product_docs"
    - "/data/requirements"
  file_types: [".docx", ".pdf", ".md", ".txt"]
  update_delay: 5  # ç§’

# é£ä¹¦é›†æˆé…ç½®
feishu:
  # é£ä¹¦åº”ç”¨é…ç½®
  app_id: "${FEISHU_APP_ID}"
  app_secret: "${FEISHU_APP_SECRET}"
  
  # APIé…ç½®
  api_base_url: "https://open.feishu.cn"
  
  # æœºå™¨äººé…ç½®
  bot:
    webhook_url: "${FEISHU_WEBHOOK_URL}"
    encrypt_key: "${FEISHU_ENCRYPT_KEY}"
    verification_token: "${FEISHU_VERIFICATION_TOKEN}"
  
  # æ–‡æ¡£åŒæ­¥é…ç½®
  sync:
    batch_size: 50  # æ‰¹é‡åŒæ­¥æ–‡æ¡£æ•°é‡
    rate_limit: 100  # æ¯åˆ†é’ŸAPIè°ƒç”¨é™åˆ¶
    retry_times: 3   # å¤±è´¥é‡è¯•æ¬¡æ•°
    sync_interval: 3600  # å…¨é‡åŒæ­¥é—´éš”(ç§’)
    
  # ç›‘å¬çš„æ–‡æ¡£æ–‡ä»¶å¤¹
  watch_folders:
    - "äº§å“éœ€æ±‚æ–‡æ¡£"
    - "æŠ€æœ¯è®¾è®¡æ–‡æ¡£" 
    - "é¡¹ç›®ç®¡ç†æ–‡æ¡£"
    - "ç”¨æˆ·ç ”ç©¶æŠ¥å‘Š"
  
  # Webhookäº‹ä»¶è®¢é˜…
  events:
    - "drive.file.created_in_folder_v1"
    - "drive.file.edit_v1"
    - "drive.file.title_updated_v1"
    - "drive.file.trashed_v1"

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "/app/logs/app.log"
  max_size: "100MB"
  backup_count: 5
```

---

## ğŸ” é£ä¹¦APIæƒé™é…ç½®

### å¿…éœ€çš„APIæƒé™

**åº”ç”¨æƒé™ç”³è¯·æ¸…å•:**
```yaml
# æ–‡æ¡£ç›¸å…³æƒé™
document_permissions:
  - "drive:drive"              # äº‘æ–‡æ¡£åŸºç¡€æƒé™
  - "docs:doc"                # é£ä¹¦æ–‡æ¡£æƒé™  
  - "sheets:spreadsheet"      # é£ä¹¦è¡¨æ ¼æƒé™
  - "wiki:wiki"               # é£ä¹¦çŸ¥è¯†åº“æƒé™
  - "bitable:app"             # å¤šç»´è¡¨æ ¼æƒé™

# ç”¨æˆ·å’Œç»„ç»‡æƒé™
user_permissions:
  - "contact:user.base:readonly"     # è¯»å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  - "contact:department.base:readonly" # è¯»å–éƒ¨é—¨ä¿¡æ¯

# æœºå™¨äººæƒé™
bot_permissions:
  - "im:message"              # å‘é€æ¶ˆæ¯æƒé™
  - "im:message.group_at_msg" # ç¾¤èŠ@æ¶ˆæ¯æƒé™
```

### å®‰å…¨é…ç½®è¦ç‚¹

**1. Tokenå®‰å…¨ç®¡ç†**
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- å®šæœŸåˆ·æ–°Access Token
- å®ç°Tokenå¤±æ•ˆè‡ªåŠ¨é‡è¯•æœºåˆ¶

**2. æƒé™æœ€å°åŒ–åŸåˆ™**
- åªç”³è¯·å¿…éœ€çš„æœ€å°æƒé™
- æŒ‰ç”¨æˆ·è§’è‰²æ§åˆ¶æ–‡æ¡£è®¿é—®
- å®šæœŸå®¡è®¡æƒé™ä½¿ç”¨æƒ…å†µ

**3. æ•°æ®å®‰å…¨**
- æœ¬åœ°å‘é‡åº“åŠ å¯†å­˜å‚¨
- APIè°ƒç”¨æ—¥å¿—è„±æ•å¤„ç†
- å®ç°æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

### é£ä¹¦APIè¯¦ç»†ä¿¡æ¯ä¸æ–‡æ¡£

#### ğŸ“š æ ¸å¿ƒAPIåˆ—è¡¨ä¸æ–‡æ¡£é“¾æ¥

**1. è®¤è¯ç›¸å…³API**

| APIåç§° | æ¥å£åœ°å€ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| è·å–tenant_access_token | `POST /open-apis/auth/v3/tenant_access_token/internal` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/authentication-management/access-token/tenant_access_token_internal) | è·å–åº”ç”¨çº§åˆ«access_token |
| è·å–user_access_token | `POST /open-apis/authen/v1/access_token` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/authentication-management/access-token/create) | OAuthç”¨æˆ·æˆæƒåè·å–ç”¨æˆ·token |

**2. äº‘æ–‡æ¡£ç›¸å…³API**

| APIåç§° | æ¥å£åœ°å€ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| è·å–æ–‡ä»¶å¤¹ä¸‹çš„æ¸…å• | `GET /open-apis/drive/v1/files` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/file/list) | è·å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ |
| è·å–æ–‡ä»¶å…ƒä¿¡æ¯ | `GET /open-apis/drive/v1/metas/batch_query` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/meta/batch_query) | æ‰¹é‡è·å–æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ |
| è·å–æ–‡æ¡£åŸå§‹å†…å®¹ | `GET /open-apis/docx/v1/documents/{document_id}/raw_content` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/docs/docx-v1/document-docx/raw_content) | è·å–é£ä¹¦æ–‡æ¡£çš„çº¯æ–‡æœ¬å†…å®¹ |
| è·å–è¡¨æ ¼æ•°æ® | `GET /open-apis/sheets/v3/spreadsheets/{spreadsheet_token}/values/{range}` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/sheets-v3/data-operation/reading-spreadsheet-data) | è·å–è¡¨æ ¼æŒ‡å®šèŒƒå›´çš„æ•°æ® |
| è·å–å¤šç»´è¡¨æ ¼ä¿¡æ¯ | `GET /open-apis/bitable/v1/apps/{app_token}/tables` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/bitable-v1/app-table/list) | è·å–å¤šç»´è¡¨æ ¼çš„è¡¨ä¿¡æ¯ |
| è·å–çŸ¥è¯†åº“èŠ‚ç‚¹ | `GET /open-apis/wiki/v2/spaces/{space_id}/nodes` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/wiki-v2/space-node/list) | è·å–çŸ¥è¯†åº“çš„èŠ‚ç‚¹åˆ—è¡¨ |

**3. æƒé™ç®¡ç†API**

| APIåç§° | æ¥å£åœ°å€ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| è·å–æ–‡æ¡£æƒé™æˆå‘˜ | `GET /open-apis/drive/v1/permissions/{token}/members` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/permission/permission-member/list) | è·å–æŒ‡å®šæ–‡æ¡£çš„æƒé™æˆå‘˜åˆ—è¡¨ |
| å¢åŠ æƒé™æˆå‘˜ | `POST /open-apis/drive/v1/permissions/{token}/members` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/permission/permission-member/create) | ä¸ºæ–‡æ¡£æ·»åŠ æƒé™æˆå‘˜ |

**4. é€šè®¯å½•API**

| APIåç§° | æ¥å£åœ°å€ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| è·å–ç”¨æˆ·ä¿¡æ¯ | `GET /open-apis/contact/v3/users/{user_id}` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/contact-v3/user/get) | è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ |
| è·å–éƒ¨é—¨ä¿¡æ¯ | `GET /open-apis/contact/v3/departments/{department_id}` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/contact-v3/department/get) | è·å–æŒ‡å®šéƒ¨é—¨ä¿¡æ¯ |
| è·å–éƒ¨é—¨ç”¨æˆ·åˆ—è¡¨ | `GET /open-apis/contact/v3/users` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/contact-v3/user/find_by_department) | è·å–éƒ¨é—¨ä¸‹çš„ç”¨æˆ·åˆ—è¡¨ |

**5. æœºå™¨äººæ¶ˆæ¯API**

| APIåç§° | æ¥å£åœ°å€ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| å‘é€æ¶ˆæ¯ | `POST /open-apis/im/v1/messages` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/im-v1/message/create) | å‘é€æ–‡æœ¬ã€å¡ç‰‡ç­‰æ¶ˆæ¯ |
| Webhookæ¥æ”¶æ¶ˆæ¯ | - | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/event-subscription-guide/event-subscription-configure-/request-url-configuration-case) | æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯å’Œç³»ç»Ÿäº‹ä»¶ |

**6. äº‹ä»¶è®¢é˜…API**

| äº‹ä»¶ç±»å‹ | äº‹ä»¶åç§° | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|---------|----------|----------|------|
| æ–‡æ¡£åˆ›å»º | `drive.file.created_in_folder_v1` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/event/file-created) | æ–‡ä»¶å¤¹å†…æ–‡æ¡£åˆ›å»ºäº‹ä»¶ |
| æ–‡æ¡£ç¼–è¾‘ | `drive.file.edit_v1` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/event/file-edited) | æ–‡æ¡£å†…å®¹ç¼–è¾‘äº‹ä»¶ |
| æ ‡é¢˜æ›´æ–° | `drive.file.title_updated_v1` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/event/file-title-updated) | æ–‡æ¡£æ ‡é¢˜æ›´æ–°äº‹ä»¶ |
| æ–‡æ¡£åˆ é™¤ | `drive.file.trashed_v1` | [æ–‡æ¡£é“¾æ¥](https://open.feishu.cn/document/server-docs/docs/drive-v1/event/file-trashed) | æ–‡æ¡£åˆ é™¤äº‹ä»¶ |

#### ğŸ”— é‡è¦æ–‡æ¡£é“¾æ¥æ±‡æ€»

**å®˜æ–¹å¼€å‘è€…ä¸­å¿ƒï¼š**
- ä¸»ç«™ï¼šhttps://open.feishu.cn/
- å¼€å‘æ–‡æ¡£ï¼šhttps://open.feishu.cn/document/
- API Explorerï¼šhttps://open.feishu.cn/api-explorer/

**æƒé™ç”³è¯·æŒ‡å—ï¼š**
- æƒé™ç®¡ç†æ–‡æ¡£ï¼šhttps://open.feishu.cn/document/server-docs/authentication-management/permission-list
- OAuth 2.0æµç¨‹ï¼šhttps://open.feishu.cn/document/server-docs/authentication-management/login-state-management/web-application-login

**SDKå’Œå·¥å…·ï¼š**
- Go SDKï¼šhttps://github.com/larksuite/oapi-sdk-go
- APIè°ƒè¯•å·¥å…·ï¼šhttps://open.feishu.cn/api-explorer/
- WebhookéªŒè¯å·¥å…·ï¼šhttps://open.feishu.cn/document/server-docs/event-subscription-guide/event-subscription-configure-/encrypt-key-authentication-case

#### ğŸ› ï¸ å¿«é€Ÿé›†æˆä»£ç ç¤ºä¾‹

**Goè¯­è¨€é›†æˆç¤ºä¾‹ï¼š**
```go
package main

import (
    "context"
    "fmt"
    
    lark "github.com/larksuite/oapi-sdk-go/v3"
    larkcore "github.com/larksuite/oapi-sdk-go/v3/core"
    larkdrive "github.com/larksuite/oapi-sdk-go/v3/service/drive/v1"
)

func main() {
    // åˆ›å»ºClient
    client := lark.NewClient("your-app-id", "your-app-secret")
    
    // è·å–æ–‡ä»¶åˆ—è¡¨
    req := larkdrive.NewListFileReq()
    req.FolderToken = larkcore.StringPtr("your-folder-token")
    req.PageSize = larkcore.Int64Ptr(50)
    
    resp, err := client.Drive.File.List(context.Background(), req)
    if err != nil {
        fmt.Printf("è°ƒç”¨å¤±è´¥: %v\n", err)
        return
    }
    
    // å¤„ç†å“åº”
    if !resp.Success() {
        fmt.Printf("APIè°ƒç”¨å¤±è´¥: %v\n", resp.Msg)
        return
    }
    
    for _, file := range resp.Data.Files {
        fmt.Printf("æ–‡ä»¶å: %s, Token: %s\n", *file.Name, *file.Token)
    }
}
```

### é£ä¹¦åº”ç”¨åˆ›å»ºæ­¥éª¤

**Step 1: åˆ›å»ºé£ä¹¦ä¼ä¸šåº”ç”¨**
```bash
1. è®¿é—® https://open.feishu.cn/app
2. ç‚¹å‡»"åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨"
3. å¡«å†™åº”ç”¨åç§°ï¼š"äº§å“æ–‡æ¡£AIåŠ©æ‰‹"
4. é€‰æ‹©åº”ç”¨ç±»å‹ï¼š"æœºå™¨äºº"
5. ä¸Šä¼ åº”ç”¨å›¾æ ‡å’Œæè¿°
```

**Step 2: é…ç½®æƒé™èŒƒå›´**
```bash
1. è¿›å…¥"æƒé™ç®¡ç†"é¡µé¢
2. æŒ‰ç…§ä¸Šè¿°æƒé™æ¸…å•ç”³è¯·æƒé™ï¼š
   - äº‘æ–‡æ¡£æƒé™ç»„ï¼šdrive:drive, docs:doc, sheets:spreadsheet, wiki:wiki, bitable:app
   - é€šè®¯å½•æƒé™ç»„ï¼šcontact:user.base:readonly, contact:department.base:readonly  
   - æœºå™¨äººæƒé™ç»„ï¼šim:message, im:message.group_at_msg
3. æäº¤å®¡æ ¸ï¼ˆé€šå¸¸éœ€è¦1-3ä¸ªå·¥ä½œæ—¥ï¼‰
4. è·å¾—ç®¡ç†å‘˜æ‰¹å‡†åç”Ÿæ•ˆ
```

**Step 3: é…ç½®äº‹ä»¶è®¢é˜…**
```bash
1. è¿›å…¥"äº‹ä»¶è®¢é˜…"é¡µé¢
2. é…ç½®è¯·æ±‚ç½‘å€ï¼šhttps://your-domain.com/webhook/feishu
3. æ·»åŠ äº‹ä»¶ï¼š
   - drive.file.created_in_folder_v1 (æ–‡æ¡£åˆ›å»º)
   - drive.file.edit_v1 (æ–‡æ¡£ç¼–è¾‘)
   - drive.file.title_updated_v1 (æ ‡é¢˜æ›´æ–°)
   - drive.file.trashed_v1 (æ–‡æ¡£åˆ é™¤)
4. éªŒè¯è¯·æ±‚ç½‘å€æœ‰æ•ˆæ€§
```

**Step 4: è·å–åº”ç”¨å‡­è¯**
```bash
1. è®°å½• App ID å’Œ App Secret
2. è®°å½• Encrypt Key å’Œ Verification Token
3. é…ç½®OAuthé‡å®šå‘URIï¼šhttps://your-domain.com/auth/callback
4. æµ‹è¯•APIè°ƒç”¨æ˜¯å¦æ­£å¸¸
```

#### ğŸ’¡ APIä½¿ç”¨æ³¨æ„äº‹é¡¹

**1. é¢‘ç‡é™åˆ¶**
- å¤§éƒ¨åˆ†APIé™åˆ¶ï¼š100æ¬¡/åˆ†é’Ÿ/åº”ç”¨
- æ–‡æ¡£å†…å®¹è·å–ï¼š50æ¬¡/åˆ†é’Ÿ/åº”ç”¨
- å»ºè®®å®ç°è¯·æ±‚é‡è¯•å’ŒæŒ‡æ•°é€€é¿æœºåˆ¶

**2. Tokenç®¡ç†**
- `tenant_access_token` æœ‰æ•ˆæœŸ2å°æ—¶ï¼Œéœ€è¦å®šæœŸåˆ·æ–°
- `user_access_token` æ ¹æ®æˆæƒèŒƒå›´æœ‰ä¸åŒæœ‰æ•ˆæœŸ
- å»ºè®®å®ç°Tokenç¼“å­˜å’Œè‡ªåŠ¨åˆ·æ–°æœºåˆ¶

**3. é”™è¯¯å¤„ç†**
- æ‰€æœ‰APIéƒ½è¿”å›æ ‡å‡†çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯
- å¸¸è§é”™è¯¯ç ï¼š99991663(æƒé™ä¸è¶³)ã€99991400(å‚æ•°é”™è¯¯)
- å»ºè®®å®ç°è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

**4. æ•°æ®æ ¼å¼**
- æ—¶é—´æ ¼å¼ç»Ÿä¸€ä½¿ç”¨Unixæ—¶é—´æˆ³
- æ–‡æ¡£Tokenæ˜¯æ–‡æ¡£çš„å”¯ä¸€æ ‡è¯†ç¬¦
- ç”¨æˆ·IDä½¿ç”¨é£ä¹¦çš„open_idæˆ–user_id

---

## ğŸ“Š æ•ˆæœé¢„æœŸä¸æˆæœ¬åˆ†æ

### é¢„æœŸæ•ˆæœ

**æ•ˆç‡æå‡:**
- ğŸ“ˆ æ–‡æ¡£æŸ¥æ‰¾æ—¶é—´å‡å°‘ **80%** (ä»å¹³å‡30åˆ†é’Ÿé™è‡³5åˆ†é’Ÿ)
- ğŸ¯ æŸ¥è¯¢å‡†ç¡®ç‡è¾¾åˆ° **90%ä»¥ä¸Š**
- ğŸ“± æ”¯æŒç§»åŠ¨ç«¯æŸ¥è¯¢ï¼Œéšæ—¶éšåœ°è®¿é—®
- ğŸ”„ æ–‡æ¡£æ›´æ–°é€šçŸ¥åŠæ—¶ç‡ **100%**

**ç”¨æˆ·ä½“éªŒ:**
- ğŸ’¬ è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œæ— éœ€è®°å¿†å…³é”®è¯
- ğŸ“± å¤šç«¯è®¿é—®ï¼ŒWeb + ç§»åŠ¨ç«¯ + é£ä¹¦
- ğŸ” æ™ºèƒ½æ¨èç›¸å…³æ–‡æ¡£
- ğŸ“Š å¯è§†åŒ–çš„æŸ¥è¯¢ç»“æœå±•ç¤º

### æˆæœ¬åˆ†æ

**å¼€å‘æˆæœ¬:**
```
äººåŠ›æˆæœ¬ï¼š
- åç«¯å¼€å‘å·¥ç¨‹å¸ˆ 1äºº Ã— 2ä¸ªæœˆ = 40K
- å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ 1äºº Ã— 1ä¸ªæœˆ = 20K  
- äº§å“ç»ç† 0.5äºº Ã— 2ä¸ªæœˆ = 15K
- æµ‹è¯•å·¥ç¨‹å¸ˆ 0.5äºº Ã— 1ä¸ªæœˆ = 8K
å°è®¡ï¼š83K

æŠ€æœ¯æˆæœ¬ï¼š
- OpenAI APIè´¹ç”¨ï¼šçº¦500å…ƒ/æœˆ
- æœåŠ¡å™¨è´¹ç”¨ï¼šçº¦2000å…ƒ/æœˆ
- å…¶ä»–å·¥å…·è´¹ç”¨ï¼šçº¦300å…ƒ/æœˆ
å°è®¡ï¼š2800å…ƒ/æœˆ
```

**æŠ•èµ„å›æŠ¥ç‡(ROI):**
```
æ—¶é—´æˆæœ¬èŠ‚çœï¼š
- 20äººå›¢é˜Ÿ Ã— 2å°æ—¶/å‘¨ Ã— 4å‘¨/æœˆ Ã— 500å…ƒ/å°æ—¶ = 80K/æœˆ

æ•ˆç‡æå‡ä»·å€¼ï¼š
- å‡å°‘é‡å¤å·¥ä½œï¼Œæå‡å†³ç­–é€Ÿåº¦
- é¢„ä¼°ä»·å€¼ï¼š20K/æœˆ

æ€»æ”¶ç›Šï¼š100K/æœˆ
æŠ•èµ„å›æ”¶æœŸï¼šçº¦1ä¸ªæœˆ
å¹´åŒ–ROIï¼šçº¦1300%
```

---

## ğŸ”„ åç»­æ‰©å±•è§„åˆ’

### Phase 4: æ™ºèƒ½åŒ–å¢å¼ºï¼ˆæœªæ¥6ä¸ªæœˆï¼‰

**å¤šæ¨¡æ€æ”¯æŒ:**
- ğŸ“· å›¾ç‰‡è¯†åˆ«å’Œç†è§£ï¼ˆæµç¨‹å›¾ã€åŸå‹å›¾ï¼‰
- ğŸ¥ è§†é¢‘å†…å®¹åˆ†æï¼ˆäº§å“æ¼”ç¤ºè§†é¢‘ï¼‰
- ğŸ“Š è¡¨æ ¼æ•°æ®æ™ºèƒ½è§£æ

**æ™ºèƒ½å†™ä½œåŠ©æ‰‹:**
- ğŸ“ åŸºäºå†å²æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆæ–°éœ€æ±‚æ–‡æ¡£
- ğŸ”„ éœ€æ±‚å˜æ›´å½±å“åˆ†æ
- ğŸ“‹ è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹

**å›¢é˜Ÿåä½œå¢å¼º:**
- ğŸ’¬ é›†æˆé’‰é’‰ã€ä¼ä¸šå¾®ä¿¡
- ğŸ“… ä¸é¡¹ç›®ç®¡ç†å·¥å…·é›†æˆï¼ˆJiraã€Trelloï¼‰
- ğŸ”” æ™ºèƒ½æé†’å’Œä»»åŠ¡åˆ†é…

### Phase 5: ç”Ÿæ€åŒ–é›†æˆï¼ˆæœªæ¥12ä¸ªæœˆï¼‰

**å¼€å‘å·¥å…·é›†æˆ:**
- ğŸ”§ ä¸IDEé›†æˆï¼ˆVS Codeæ’ä»¶ï¼‰
- ğŸ“± ç§»åŠ¨ç«¯åŸç”Ÿåº”ç”¨
- ğŸŒ æµè§ˆå™¨æ’ä»¶

**æ•°æ®æ´å¯Ÿ:**
- ğŸ“ˆ æ–‡æ¡£ä½¿ç”¨æƒ…å†µåˆ†æ
- ğŸ¯ çƒ­é—¨éœ€æ±‚è¯†åˆ«
- ğŸ“Š å›¢é˜ŸçŸ¥è¯†å›¾è°±æ„å»º

---

## âœ… ç»“è®ºä¸å»ºè®®

### é¡¹ç›®å¯è¡Œæ€§è¯„ä¼°: â­â­â­â­â­

**æŠ€æœ¯å¯è¡Œæ€§:** ğŸŸ¢ **é«˜**
- Einoæ¡†æ¶æˆç†Ÿç¨³å®šï¼Œç¤¾åŒºæ´»è·ƒ
- RAGæŠ€æœ¯æ–¹æ¡ˆç»è¿‡éªŒè¯
- æ‰€éœ€æŠ€æœ¯æ ˆå›¢é˜Ÿå·²æŒæ¡

**å•†ä¸šä»·å€¼:** ğŸŸ¢ **é«˜**
- ç›´æ¥è§£å†³å›¢é˜Ÿç—›ç‚¹
- ROIæ˜¾è‘—ï¼ŒæŠ•èµ„å›æ”¶æœŸçŸ­
- å¯æ‰©å±•åˆ°å…¶ä»–ä¸šåŠ¡åœºæ™¯

**å®æ–½é£é™©:** ğŸŸ¡ **ä½**
- æŠ€æœ¯é£é™©å¯æ§
- å¼€å‘å‘¨æœŸåˆç†
- æœ‰é™çº§æ–¹æ¡ˆ

### é£ä¹¦é›†æˆç‰¹æ®Šä¼˜åŠ¿:

**ğŸ¯ æ— ç¼ä½“éªŒ:**
- æ–‡æ¡£æºå¤´ç›´æ¥æ¥å…¥ï¼Œæ— éœ€å¯¼å‡ºå¯¼å…¥
- æƒé™ä½“ç³»å¤©ç„¶åŒæ­¥ï¼Œå®‰å…¨å¯é 
- ç”¨æˆ·æ— éœ€å­¦ä¹ æ–°å·¥å…·ï¼Œåœ¨é£ä¹¦å†…ç›´æ¥ä½¿ç”¨

**ğŸ”„ å®æ—¶æ€§å¼º:**
- Webhookå®æ—¶ç›‘å¬æ–‡æ¡£å˜æ›´
- å¢é‡æ›´æ–°ï¼Œèµ„æºæ¶ˆè€—ä½
- å›¢é˜Ÿåä½œä¿¡æ¯åŠæ—¶åŒæ­¥

**ğŸ“± ç§»åŠ¨å‹å¥½:**
- é£ä¹¦ç§»åŠ¨ç«¯åŸç”Ÿæ”¯æŒ
- éšæ—¶éšåœ°æŸ¥è¯¢æ–‡æ¡£ä¿¡æ¯
- æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³å›å¤

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®:

1. **é£ä¹¦åº”ç”¨ç”³è¯·:** ç«‹å³åˆ›å»ºä¼ä¸šåº”ç”¨å¹¶ç”³è¯·æƒé™ï¼ˆ3-5å¤©ï¼‰
2. **APIæ¥å£æµ‹è¯•:** éªŒè¯é£ä¹¦æ–‡æ¡£APIå¯ç”¨æ€§ï¼ˆ2å¤©ï¼‰
3. **Einoç¯å¢ƒæ­å»º:** é…ç½®å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼ˆ3å¤©ï¼‰
4. **æ ¸å¿ƒåŠŸèƒ½å¼€å‘:** æŒ‰ç…§å®æ–½è®¡åˆ’å¼€å§‹å¼€å‘ï¼ˆ4å‘¨ï¼‰

**å…³é”®é‡Œç¨‹ç¢‘:**
- **ç¬¬1å‘¨:** é£ä¹¦APIé›†æˆå’Œæƒé™é…ç½®å®Œæˆ
- **ç¬¬2-3å‘¨:** æ–‡æ¡£åŒæ­¥å’Œå‘é‡åŒ–åŠŸèƒ½å¼€å‘  
- **ç¬¬4-5å‘¨:** æ™ºèƒ½é—®ç­”å’Œå®æ—¶æ›´æ–°åŠŸèƒ½
- **ç¬¬6å‘¨:** é£ä¹¦æœºå™¨äººå’Œç”¨æˆ·ç•Œé¢å¼€å‘
- **ç¬¬7-8å‘¨:** æµ‹è¯•ä¼˜åŒ–å’Œä¸Šçº¿éƒ¨ç½²

**é¢„è®¡é¡¹ç›®å¯åŠ¨æ—¶é—´:** 1å‘¨åï¼ˆç­‰å¾…é£ä¹¦æƒé™å®¡æ‰¹ï¼‰
**é¢„è®¡MVPç‰ˆæœ¬ä¸Šçº¿:** 6å‘¨å
**é¢„è®¡å®Œæ•´åŠŸèƒ½ä¸Šçº¿:** 8å‘¨å

---

*è¿™ä¸ªæ–¹æ¡ˆå……åˆ†åˆ©ç”¨äº†Einoæ¡†æ¶çš„ä¼˜åŠ¿ï¼Œæ—¢è§£å†³äº†å®é™…ä¸šåŠ¡ç—›ç‚¹ï¼Œåˆå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ã€‚å»ºè®®ä¼˜å…ˆå¯åŠ¨ï¼* ğŸš€